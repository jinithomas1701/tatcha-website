{"version":3,"sources":["node_modules/browser-pack/_prelude.js","int_smartorderrefill/cartridge/client/default/js/app.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* eslint-disable no-useless-concat */\r\n/* eslint-disable no-alert */\r\n/* eslint-disable no-restricted-syntax, guard-for-in, no-param-reassign,*/\r\n\"use strict\";\r\n/* global SmartOrderRefillSettings, jQuery */\r\n(function ($) {\r\n    /**\r\n     *  Property of OSF Global Services, Inc., (with its brand OSF Commerce). OSF remains the sole owner of all right, title and interest in the software.\r\n     *  Do not copy, sell, reverse engineer or otherwise attempt to derive or obtain information about the functioning, manufacture or operation therein.\r\n     */\r\n    /* ***** Start of Util section ***** */\r\n    /**\r\n     * @description SmartOrderRefill constructor\r\n     */\r\n    function SmartOrderRefill() {}\r\n\r\n    // Form Validation\r\n    SmartOrderRefill.validateForm = function (element) {\r\n        var formValid = true;\r\n        element.find(\".field-wrapper\").each(function () {\r\n            var fieldWrapper = $(this);\r\n            var field = fieldWrapper.find(\"input, select\");\r\n            if (field.length > 0) {\r\n                field.removeClass(\"error\");\r\n                fieldWrapper.find(\"label.error\").addClass(\"hide\");\r\n                var validState = field[0].validity;\r\n\r\n                if (!validState.valid) {\r\n                    formValid = false;\r\n                    field.addClass(\"error\");\r\n                    if (validState.valueMissing) {\r\n                        fieldWrapper.find(\"label.error.missing-error\").removeClass(\"hide\");\r\n                    } else {\r\n                        fieldWrapper.find(\"label.error.value-error\").removeClass(\"hide\");\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return formValid;\r\n    };\r\n\r\n    // Create Modal Up To Modal Type\r\n    SmartOrderRefill.createModal = function (container, options) {\r\n        if (options.buttons && Object.keys(options.buttons).length > 0) {\r\n            var buttons = {};\r\n            for (var key in options.buttons) {\r\n                if (key.indexOf(\"SOR_GLOBAL_\") > -1) {\r\n                    buttons[SmartOrderRefillSettings.Resources[key]] = options.buttons[key];\r\n                } else {\r\n                    buttons[key] = options.buttons[key];\r\n                }\r\n            }\r\n            options.buttons = buttons;\r\n        }\r\n        if (SmartOrderRefillSettings.ModalType === \"dialog\") {\r\n            $(container).dialog(options);\r\n        } else {\r\n            SmartOrderRefill.bootstrapModal(container, options);\r\n        }\r\n    };\r\n\r\n    // Generic Modal Close\r\n    SmartOrderRefill.closeModal = function () {\r\n        if (SmartOrderRefillSettings.ModalType === \"dialog\") {\r\n            $(this).closest(\".ui-dialog-content\").dialog(\"close\");\r\n        } else {\r\n            var modal = $(this).closest(\".modal\");\r\n            if (modal.length === 0) {\r\n                modal = $(this).find(\".modal\");\r\n            }\r\n            modal.modal(\"hide\");\r\n        }\r\n    };\r\n\r\n    // Bootstrap Modal\r\n    SmartOrderRefill.bootstrapModal = function (container, options) {\r\n        var buttonsMarkUp = \"\";\r\n        var title = options.title ? options.title : \"\";\r\n        var width = options.width ? \"style=\\\"max-width:\" + options.width + \"!important;\\\"\" : \"\";\r\n        var buttons = options.buttons;\r\n        if (buttons && Object.keys(buttons).length > 0) {\r\n            buttonsMarkUp += \"<div class=\\\"modal-footer\\\">\";\r\n            $(container).off(\"click\", \"#sorModalCenter button.action\");\r\n            for (var key in buttons) {\r\n                buttonsMarkUp += \"<button type=\\\"button\\\" class=\\\"btn btn-primary action\\\"  data-id=\\\"\" + key + \"\\\">\" + key + \"</button>\";\r\n                $(container).on(\"click\", \"#sorModalCenter button.action[data-id=\\\"\" + key + \"\\\"]\", buttons[key]);\r\n            }\r\n            buttonsMarkUp += \"<div>\";\r\n        }\r\n\r\n        var bootstrap = `<div class=\"modal fade\" id=\"sorModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"sorModalCenter\" aria-hidden=\"true\">\r\n            <div class=\"modal-dialog modal-dialog-centered\" ${width}  role=\"document\">\r\n                <div class=\"modal-content\">\r\n                    <div class=\"modal-header\">\r\n                        <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">${title}</h5>\r\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                        </button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        ${container.html()}\r\n                    </div>\r\n                    ${buttonsMarkUp}\r\n                </div>\r\n            </div>\r\n        </div>`;\r\n        container.html(bootstrap);\r\n        container.find(\".modal\").on(\"shown.bs.modal\", function () {\r\n            var subscriptionModals = $(\"#subscriptionview, #orderview\");\r\n            if (subscriptionModals.length > 0 && !container.is(subscriptionModals)) {\r\n                container.siblings(\".modal-backdrop\").last().css(\"z-index\", \"1060\");\r\n                container.find(\".modal\").css(\"z-index\", \"1070\");\r\n            }\r\n        });\r\n        container.find(\".modal\").modal({\r\n            backdrop: \"static\"\r\n        });\r\n        container.find(\".modal\").modal(\"show\");\r\n        container.find(\".modal\").on(\"hidden.bs.modal\", function () {\r\n            container.remove();\r\n            if ($(\"#subscriptionview, #orderview, #error-model\").length > 0) {\r\n                $(\"body\").addClass(\"modal-open\");\r\n            }\r\n        });\r\n    };\r\n\r\n    SmartOrderRefill.limitCharacters = function () {\r\n        $(\"form\").find(\"textarea[data-character-limit]\").each(function () {\r\n            var characterLimit = $(this).data(\"character-limit\");\r\n            var charCountHtml = String.format(SmartOrderRefillSettings.Resources.CHAR_LIMIT_MSG,\r\n                    \"<span class=\\\"char-remain-count\\\">\" + characterLimit + \"</span>\",\r\n                    \"<span class=\\\"char-allowed-count\\\">\" + characterLimit + \"</span>\");\r\n            var charCountContainer = $(this).next(\"div.char-count\");\r\n            if (charCountContainer.length === 0) {\r\n                charCountContainer = $(\"<div class=\\\"char-count\\\"/>\").insertAfter($(this));\r\n            }\r\n            charCountContainer.html(charCountHtml);\r\n            // trigger the keydown event so that any existing character data is calculated\r\n            $(this).change();\r\n        });\r\n    };\r\n\r\n    SmartOrderRefill.creatContainer = function (selector) {\r\n        var $target;\r\n        var id;\r\n        if (jQuery.type(selector) === \"string\") {\r\n            if (selector.indexOf(\"#\") === 0) {\r\n                $target = $(selector, document);\r\n                $target.selector = selector;\r\n            } else {\r\n                $target = $(\"#\" + selector, document);\r\n                $target.selector = \"#\" + selector;\r\n            }\r\n        } else if (selector instanceof jQuery) {\r\n            $target = selector;\r\n        }\r\n\r\n        if ($target && $target.length === 0) {\r\n            if ($target.selector && $target.selector.indexOf(\"#\") === 0) {\r\n                id = $target.selector.substr(1);\r\n                $target = $(\"<div>\").attr(\"id\", id).appendTo(\"body\");\r\n            }\r\n        }\r\n        return $target;\r\n    };\r\n    /**\r\n     * @description get parameter value from url\r\n     * @param {string} url url to pars\r\n     * @param {string} name parameter to find\r\n     * @returns {string} paramer value\r\n     */\r\n    function getURLParameter(url, name) {\r\n        return (RegExp(name + \"=\" + \"(.+?)(&|$)\").exec(url) || [, null])[1]; //eslint-disable-line\r\n    }\r\n\r\n    /* ****** End of Util section ****** */\r\n\r\n\r\n    /* ****** Start of Account section ******* */\r\n    /**\r\n     * @description fill Address Fields\r\n     * @param {Object} address address object\r\n     * @param {Object} $form form object\r\n     */\r\n    function fillAddressFields(address, $form) {\r\n        for (var field in address) {\r\n            if (field === \"ID\" || field === \"UUID\" || field === \"key\") {\r\n                // eslint-disable-next-line no-continue\r\n                continue;\r\n            }\r\n            $form.find(\"[name$=\\\"\" + field.replace(\"Code\", \"\") + \"\\\"]\").val(address[field]);\r\n\r\n            if (field === \"countryCode\") {\r\n                $form.find(\"[name$=\\\"country\\\"]\").trigger(\"change\");\r\n                $form.find(\"[name$=\\\"state\\\"]\").val(address.stateCode);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @description filter product variation\r\n     */\r\n    function filterProductVariants() {\r\n        $(document).on(\"click\", \"#dwfrm_addproduct_product\", function (e) {\r\n            e.preventDefault();\r\n            var selectedProduct = $(this).children(\"option:selected\").val();\r\n            var variations = $(\"#dwfrm_addproduct_variation\").children(\"option\");\r\n            variations.show();\r\n            for (var i = 0; i < variations.length; i++) {\r\n                var variants = variations[i];\r\n                var variant = $(variants).data(\"master\");\r\n                if (selectedProduct !== variant) {\r\n                    $(\"#dwfrm_addproduct_variation\").children(\"option[data-master=\" + \"\\\"\" + variant + \"\\\"\" + \"]\").hide();\r\n                }\r\n                if (selectedProduct === variant) {\r\n                    $(\"#dwfrm_addproduct_variation\").children(\"option\").filter(function () {\r\n                        return ($(this).data(\"master\") === selectedProduct);\r\n                    }).prop(\"selected\", true);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n    * @description filter product intervals\r\n    */\r\n    function filterProductRefill() {\r\n        var periods = $(\"#dwfrm_addproduct_periodicity\").children(\"option\");\r\n\r\n        if (periods.length > 1) {\r\n            $(\"#dwfrm_addproduct_interval\").children(\"option\").filter(function () {\r\n                return ($(this).data(\"periodicity\") !== \"week\");\r\n            }).hide();\r\n        }\r\n\r\n        $(\"#dwfrm_addproduct_periodicity\").on(\"change\", function () {\r\n            var selectedPeriod = $(this).children(\"option:selected\").val();\r\n            var intervals = $(\"#dwfrm_addproduct_interval\").children(\"option\");\r\n            intervals.show();\r\n            for (var i = 0; i < intervals.length; i++) {\r\n                var interval2 = intervals[i];\r\n                var intervalPeriod = $(interval2).data(\"periodicity\");\r\n                if (selectedPeriod !== intervalPeriod) {\r\n                    // eslint-disable-next-line no-useless-concat\r\n                    $(\"#dwfrm_addproduct_interval\").children(\"option[data-periodicity=\" + \"\\\"\" + intervalPeriod + \"\\\"\" + \"]\").hide();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    SmartOrderRefill.initAddressChangeForm = function (target, urlview) {\r\n        $(document).off(\"click\", \".changeaddress\").on(\"click\", \".changeaddress\", function (e) {\r\n            /*if (!e.detail || e.detail === 1) {\r\n                \r\n                var url = $(this).attr(\"data-url\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#addresschange\");\r\n                var options = SmartOrderRefill.ModalOptions.addressChangeFormOptions(target, urlview, $container);\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.createModal($container, options);\r\n                    var $form = $(\"#editAddressForm\");\r\n\r\n                    $(\"select[name$=\\\"_changeaddress\\\"]\", $form).on(\"change\", function () {\r\n                        var selected = $(this).children(\":selected\").first();\r\n                        var selectedAddress = $(selected).data(\"address\");\r\n                        if (!selectedAddress) {\r\n                            return;\r\n                        }\r\n                        fillAddressFields(selectedAddress, $form);\r\n                        SmartOrderRefill.validateForm($form);\r\n                    });\r\n                });\r\n            }*/ \r\n        \t\r\n            e.preventDefault();\r\n         \t$('.loader-preventive').show();\r\n         \tvar url = $(this).attr('data-url');\r\n         \t$.get( url , function( data ) {\r\n         \t  $('#addressModal .modal-content').html(data);\r\n         \t  $('#addressModal').modal('show');\r\n         \t  $('.loader-preventive').hide();\r\n         \t});\r\n        });\r\n        \r\n        $(document).on('click', 'input[name=\"dwfrm_changeaddress\"]', function(){\r\n\t\t\t$('.radio-changeaddress').removeClass('selected');\r\n\t\t\t$(this).parents('.radio-changeaddress').addClass('selected');\r\n\t\t});\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize dialog for order view\r\n     */\r\n    SmartOrderRefill.initOrderView = function () {\r\n        $(\".order.view\").on(\"click\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#orderview\");\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.limitCharacters();\r\n                    SmartOrderRefill.createModal($container, SmartOrderRefill.ModalOptions.orderViewOptions);\r\n                    SmartOrderRefill.initAddressChangeForm(\"#orderview\", url);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize dialog for subscription view\r\n     */\r\n    SmartOrderRefill.initSubscriptionView = function () {\r\n        $(\".subscription.view\").on(\"click\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#subscriptionview\");\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.limitCharacters();\r\n                    SmartOrderRefill.createModal($container, SmartOrderRefill.ModalOptions.subscriptionViewOptions);\r\n                    SmartOrderRefill.initAddressChangeForm(\"#subscriptionview\", url);\r\n                    SmartOrderRefill.initUpdateCreditCardForm();\r\n                    SmartOrderRefill.initAddProductForm();\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize update product quantity\r\n     */\r\n    SmartOrderRefill.initUpdateProductQuantity = function () {\r\n        $(document).on(\"click\", \".update-item\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n\r\n                var url = $(this).attr(\"data-link\");\r\n                var item = getURLParameter(url, \"item\");\r\n                var quantity = $(this).parents(\".order-section\").find(\"#quantity_\" + item).val();\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: url,\r\n                    data: {\r\n                        quantity: quantity\r\n                    }\r\n                }).done(function (response) {\r\n                    if (response) {\r\n                        if ($(\"#qtyError\").length) {\r\n                            $(\"#qtyError\").remove();\r\n                        }\r\n                        if (response.success) {\r\n                            window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                        } else if (!$(\"#qtyError\").length) {\r\n                            $(\"<label class=\\\"error\\\" id=\\\"qtyError\\\">\" + response.message + \"</label>\").insertAfter(\"#quantity_\" + item);\r\n                        }\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_QUANTITY_ERROR, false);\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize remove product\r\n     */\r\n    SmartOrderRefill.initRemoveProduct = function () {\r\n        $(document).on(\"click\", \".remove-item\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: url\r\n                }).done(function (response) {\r\n                    if (response && response.success) {\r\n                        window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_QUANTITY_ERROR, false);\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }\r\n        });\r\n    };\r\n /**\r\n     * @private\r\n     * @function\r\n     * @description initialize dialog for add product\r\n     */\r\n    SmartOrderRefill.initAddProductForm = function () {\r\n        $(document).off(\"click\", \".addproduct\").on(\"click\", \".addproduct\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#addproduct\");\r\n                var options = SmartOrderRefill.ModalOptions.addProductOptions;\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.createModal($container, options);\r\n                    filterProductVariants();\r\n                    filterProductRefill();\r\n                    $(\"#dwfrm_addproduct_product\").trigger(\"click\");\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize change product form\r\n     */\r\n    SmartOrderRefill.initChangeProductForm = function () {\r\n        $(document).off(\"click\", \".change-item\").on(\"click\", \".change-item\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#changeproduct\");\r\n                var options = SmartOrderRefill.ModalOptions.changeProductFormOptions;\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.createModal($container, options);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize dialog for update credit card view\r\n     */\r\n    SmartOrderRefill.initUpdateCreditCardForm = function () {\r\n        $(document).off(\"click\", \".update-card\").on(\"click\", \".update-card\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#updatecreditcard\");\r\n                var options = SmartOrderRefill.ModalOptions.updateCreditCardFormOptions;\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.createModal($container, options);\r\n                    $(\".choose-card-item\").on(\"click\", function () {\r\n                        $(this).find(\"input[type=\\\"radio\\\"]\").prop(\"checked\", true);\r\n                    });\r\n                    $(\"select[id$='_updatecard_expiration_month']\").val(parseInt($(\"#updatecreditcard\").find(\".expiration-date-wrapper\").attr(\"data-expmonth\"), 10));\r\n                    $(\"select[id$='_updatecard_expiration_year']\").val($(\"#updatecreditcard\").find(\".expiration-date-wrapper\").attr(\"data-expyear\"));\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize update refill\r\n     */\r\n    SmartOrderRefill.initUpdateRefill = function () {\r\n        $(document).on(\"click\", \".update-refill\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var item = getURLParameter(url, \"item\");\r\n                var periodicity = $(\"#select-everydelivery-\" + item).val();\r\n                var interval = (periodicity === \"month\") ? $(\"#sorMonth-\" + item).val() : $(\"#sorWeek-\" + item).val();\r\n                var sorNextDate = $(\"#sorNextDate-\" + item).val();\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: url,\r\n                    data: {\r\n                        periodicity: periodicity,\r\n                        interval: interval,\r\n                        sorNextDate: sorNextDate\r\n                    }\r\n                }).done(function (response) {\r\n                    if (response && response.success) {\r\n                        window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_QUANTITY_ERROR, false);\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize credit card expiration warning\r\n     */\r\n    SmartOrderRefill.initCreditCardExpirationWarning = function () {\r\n        /**\r\n         * @description determin if card expiration worning should be shown\r\n         * @param {string} month month form element value\r\n         * @param {string} year year form element value\r\n         */\r\n        function toggleExpirationWarning(month, year) {\r\n            if (typeof month !== \"undefined\" && typeof year !== \"undefined\" && month && year) {\r\n                var expirationDate = new Date(new Date(year, month).setDate(0));\r\n                var currentDate = new Date();\r\n                var nextYear = new Date(currentDate.getFullYear() + 1, currentDate.getMonth(), currentDate.getDate() - 1);\r\n\r\n                if ((expirationDate - nextYear) <= 0) {\r\n                    $(\".credit_card_expiration_warning\").show();\r\n                } else {\r\n                    $(\".credit_card_expiration_warning\").hide();\r\n                }\r\n            }\r\n        }\r\n\r\n        $(document).on(\"change\", \".pt_checkout [name$=\\\"creditCard_expiration_month\\\"], .pt_checkout [name$=\\\"creditCard_expiration_year\\\"]\", function () {\r\n            var month = $(\".pt_checkout [name$=\\\"creditCard_expiration_month\\\"]\").val();\r\n            var year = $(\".pt_checkout [name$=\\\"creditCard_expiration_year\\\"]\").val();\r\n            toggleExpirationWarning(month, year);\r\n        });\r\n        $(document).on(\"change\", \"#checkout-main [name$=\\\"creditCardFields_expirationMonth\\\"], #checkout-main [name$=\\\"creditCardFields_expirationYear\\\"]\", function () {\r\n            var month = $(\"#checkout-main [name$=\\\"creditCardFields_expirationMonth\\\"]\").val();\r\n            var year = $(\"#checkout-main [name$=\\\"creditCardFields_expirationYear\\\"\").val();\r\n            toggleExpirationWarning(month, year);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize reactivate order view\r\n     */\r\n    SmartOrderRefill.initReactivateOrderView = function () {\r\n        $(document).off(\"click\", \".order.reactivate\").on(\"click\", \".order.reactivate\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var order = getURLParameter(url, \"sid\");\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: url,\r\n                    data: {\r\n                        order: order\r\n                    }\r\n                }).done(function (response) {\r\n                    if (response) {\r\n                        if (!response.success) {\r\n                            var $container = SmartOrderRefill.creatContainer(\"#reactivate-order\");\r\n                            $container.html(\"<h3>\" + SmartOrderRefillSettings.Resources.SOR_REACTIVE_ORDER_MESSAGE + \"</h3>\");\r\n                            SmartOrderRefill.createModal($container, SmartOrderRefill.ModalOptions.reactivateOrderViewOptions);\r\n                        } else {\r\n                            window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                        }\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description initialize reactivate subscription view\r\n     */\r\n    SmartOrderRefill.initReactivateSubscriptionView = function () {\r\n        $(document).off(\"click\", \".reactivatesubscription\").on(\"click\", \".reactivatesubscription\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#reactivate-subscription\");\r\n                var options = SmartOrderRefill.ModalOptions.reactivateSubscriptionOptions;\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.createModal($container, options);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    /* ****** End of Account section ****** */\r\n\r\n    /* ******* Start of Cart section ******* */\r\n\r\n    SmartOrderRefill.initModifyRefill = function () {\r\n        $(document).on(\"click\", \"#modifyRefill\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var $container = SmartOrderRefill.creatContainer(\"#modify-smart-order-refill\");\r\n\r\n                $container.load(url, function () {\r\n                    SmartOrderRefill.limitCharacters();\r\n                    SmartOrderRefill.createModal($container, SmartOrderRefill.ModalOptions.modifyRefillOptions);\r\n                    // force to load the selected value of sor subscriptions\r\n                    $(\"[name=\\\"everyDelivery\\\"]\").trigger(\"change\");\r\n                    $(\"#modify-smart-order-refill select\").on(\"change\", function () {\r\n                        $(\"#multipleRefill\").prop(\"checked\", true);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    SmartOrderRefill.initRemoveRefill = function () {\r\n        $(document).on(\"click\", \"#removeRefill\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var url = $(this).attr(\"data-link\");\r\n                var cartShow = SmartOrderRefillSettings.Urls.cartShow;\r\n\r\n                $.ajax({\r\n                    type: \"GET\",\r\n                    url: url,\r\n                    success: function (response) {\r\n                        if (response && response.success) {\r\n                            window.location = cartShow;\r\n                        } else {\r\n                            SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    SmartOrderRefill.initLoginFromCart = function () {\r\n        $(document).on(\"click\", \"#message_wrapper a\", function () {\r\n            var $container = SmartOrderRefill.creatContainer(\"#sorlogin\");\r\n            var options = {\r\n                modal: true,\r\n                width: \"50rem\",\r\n                open: function () {\r\n\r\n                }\r\n            };\r\n            $container.load(SmartOrderRefillSettings.Urls.loginFromCartPage, function () {\r\n                SmartOrderRefill.limitCharacters();\r\n                SmartOrderRefill.createModal($container, options);\r\n            });\r\n        });\r\n        $(document).on(\"click\", \"#sorlogin button\", function (e) {\r\n            if (!e.detail || e.detail === 1) {\r\n                e.preventDefault();\r\n                var form = $(this).parents(\"form:first\");\r\n                if (SmartOrderRefill.validateForm(form)) {\r\n                    var url = form.attr(\"action\");\r\n                    var data = {};\r\n                    form.serializeArray().forEach(function (param) {\r\n                        data[param.name] = param.value;\r\n                    });\r\n\r\n                    $.ajax({\r\n                        type: \"POST\",\r\n                        url: url,\r\n                        data: data,\r\n                        success: function (response) {\r\n                            if (!response) {\r\n                                SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                            } else if (response.success) {\r\n                                if ($(\"#loginFromCartError\").length) {\r\n                                    $(\"#loginFromCartError\").remove();\r\n                                }\r\n                                window.location = response.url;\r\n                            } else if (!$(\"#loginFromCartError\").length) {\r\n                                form.prepend(\"<div id=\\\"loginFromCartError\\\" class=\\\"error-form\\\">\" + SmartOrderRefillSettings.Resources.SOR_LOGINFROMCART_ERROR + \"</div>\");\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    /* ******* End of Cart section ******* */\r\n\r\n    /* ******* Start of Product section ******* */\r\n\r\n    SmartOrderRefill.initializePdp = function () {\r\n        /**\r\n         * @description Show or hide the schedule select based on user selection.\r\n         * @param {boolean} value form element value\r\n         */\r\n        function hideOrShowSchedules(value) {\r\n            if (value === \"true\") {\r\n                if (window.innerWidth < 568) {\r\n                    $(\".smart-order-refill-period\").attr(\"style\", \"margin: 0.9375rem 1.25rem\");\r\n                }\r\n                $(\".smart-order-refill-period\").attr(\"style\", \"display:inline-block\");\r\n                $(\"#addProductbtn\").attr(\"style\", \"\");\r\n                $(\"#everyDelivery\").trigger(\"change\");\r\n            } else {\r\n                $(\".or-cancel-edit-text\").attr(\"style\", \"margin-top:0.625rem\");\r\n                $(\".smart-order-refill-period\").attr(\"style\", \"display:none\");\r\n                $(\"#addProductbtn\").attr(\"style\", \"display:none\");\r\n            }\r\n        }\r\n        /**\r\n         * @description initializa options\r\n         */\r\n        function initOptions() {\r\n            if (!$(\".smart-order-refill-options\").data(\"sorOneTime\")) {\r\n                $(\".smart-order-refill-options [for=\\\"OsfSorRefillProductNo\\\"], .smart-order-refill-options [for=\\\"OsfSorRefillProductYes\\\"]\").hide();\r\n                $(\"#OsfSorRefillProductYes\").prop(\"checked\", true);\r\n            }\r\n            if ($(\".smart-order-refill-period p\").data(\"disableDropdown\")) {\r\n                $(\"#SorDeliveryWeekInterval, #SorDeliveryMonthInterval\").css({\r\n                    display: \"none\"\r\n                });\r\n            }\r\n        }\r\n\r\n        initOptions();\r\n\r\n        $(document).on(\"click\", \"#pdpMain .product-add-to-cart select#SorDeliveryMonthInterval\", function () {\r\n            $(\"input[name=\\\"hasSmartOrderRefill\\\"]\").val([\"true\"]);\r\n        });\r\n\r\n        $(\"input[name=hasSmartOrderRefill]\").change(function () {\r\n            hideOrShowSchedules($(this).val());\r\n        });\r\n\r\n        $(document).on(\"change\", \"[name=\\\"everyDelivery\\\"]\", function () {\r\n            if ($(this).val() === \"month\") {\r\n                $(\"select[name=SorDeliveryWeekInterval]\").hide();\r\n                $(\"select[name=SorDeliveryMonthInterval]\").show();\r\n                if ($(\".smart-order-refill-period p\").data(\"disableDropdown\")) {\r\n                    $(\"#SorDeliveryWeekInterval, #SorDeliveryMonthInterval\").css({\r\n                        display: \"none\"\r\n                    });\r\n                }\r\n            } else if ($(this).val() === \"week\") {\r\n                $(\"select[name=SorDeliveryMonthInterval]\").hide();\r\n                $(\"select[name=SorDeliveryWeekInterval]\").show();\r\n                if ($(\".smart-order-refill-period p\").data(\"disableDropdown\")) {\r\n                    $(\"#SorDeliveryWeekInterval, #SorDeliveryMonthInterval\").css({\r\n                        display: \"none\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\"[name=\\\"everyDelivery\\\"], select[name=\\\"SorDeliveryWeekInterval\\\"], select[name=\\\"SorDeliveryMonthInterval\\\"]\").on(\"change\", function () {\r\n            var everyDeliveryHasValueSelected = $(\"[name=\\\"everyDelivery\\\"]\").val();\r\n            var weekIntervalHasValueSelected = $(\"select[name=SorDeliveryWeekInterval]\").val();\r\n            var monthIntervalHasValueSelected = $(\"select[name=SorDeliveryMonthInterval]\").val();\r\n            var sorDataInformed = everyDeliveryHasValueSelected || (weekIntervalHasValueSelected || monthIntervalHasValueSelected);\r\n            var variantSelected = $(\".product-number span\").text();\r\n            var shouldEnableAddToCartButton = sorDataInformed && (variantSelected !== \"undefined\");\r\n            var disabled = false;\r\n            if ($(\".add-to-cart\").length !== 0) {\r\n                if ($(\".add-to-cart\")[0].disabled) {\r\n                    $(\".addFromPDP\").prop(\"disabled\", true);\r\n                    disabled = true;\r\n                }\r\n            } else if ($(\"#add-to-cart\").length !== 0) {\r\n                if ($(\"#add-to-cart\")[0].disabled) {\r\n                    $(\".addFromPDP\").prop(\"disabled\", true);\r\n                    disabled = true;\r\n                }\r\n            }\r\n            if (shouldEnableAddToCartButton && !disabled) {\r\n                $(\"#add-to-cart\").removeAttr(\"disabled\");\r\n                $(\".addFromPDP\").prop(\"disabled\", false);\r\n                if ($(\"#OsfSorRefillProductYes\").prop(\"checked\")) {\r\n                    var quantity;\r\n                    if ($(\".quantity input\").length !== 0) {\r\n                        if (Number($(\".quantity input\").val()) > 0) {\r\n                            quantity = Number($(\".quantity input\").val());\r\n                        } else {\r\n                            $(\"#add-to-cart\").attr(\"disabled\", \"disabled\");\r\n                            $(\".addFromPDP\").prop(\"disabled\", true);\r\n                        }\r\n                    } else {\r\n                        for (var q = 0; q < $(\".quantity-select option\").length; q++) {\r\n                            var qut = $(\".quantity-select option\")[q];\r\n                            if (qut.selected === true) {\r\n                                quantity = $(\".quantity-select option\")[q].value;\r\n                            }\r\n                        }\r\n                    }\r\n                    $.ajax({\r\n                        type: \"POST\",\r\n                        url: SmartOrderRefillSettings.Urls.checkProductRefill,\r\n                        data: {\r\n                            hasSmartOrderRefill: $(\"[name=\\\"hasSmartOrderRefill\\\"]\").filter(\":checked\").val(),\r\n                            everyDelivery: $(\"[name=\\\"everyDelivery\\\"]\").val(),\r\n                            SorDeliveryWeekInterval: $(\"[name=\\\"SorDeliveryWeekInterval\\\"]\").val(),\r\n                            SorDeliveryMonthInterval: $(\"[name=\\\"SorDeliveryMonthInterval\\\"]\").val(),\r\n                            variantSelected: $(\"input[name=variantSelected]\").val(),\r\n                            pid: variantSelected,\r\n                            quantity: quantity\r\n                        }\r\n                    }).done(function (data) {\r\n                        if (data) {\r\n                            if (data.success === true) {\r\n                                $(\"#addProductbtn\").removeClass(\"hide\");\r\n                                $(\".addFromPDP\").data(\"subIDs\", data.subscriptionIDs);\r\n                                $(\".addFromPDP\").data(\"pid\", variantSelected);\r\n                                $(\".addFromPDP\").data(\"interval\", data.interval);\r\n                                $(\".addFromPDP\").data(\"periodicity\", data.periodicity);\r\n                                $(\".addFromPDP\").data(\"quantity\", quantity);\r\n                            } else {\r\n                                $(\"#addProductbtn\").addClass(\"hide\");\r\n                                $(\".or-cancel-edit-text\").css(\"margin\", \"0 0 1rem 0rem\");\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                $(\"#addProductbtn\").removeClass(\"hide\");\r\n                $(\"#add-to-cart\").attr(\"disabled\", \"disabled\");\r\n                $(\".addFromPDP\").prop(\"disabled\", true);\r\n            }\r\n        });\r\n        $(\".addFromPDP\").on(\"click\", function (e) {\r\n            e.preventDefault();\r\n            var link = $(this).attr(\"data-link\");\r\n            var subIDs = $(this).data(\"subIDs\");\r\n            var pid = $(this).data(\"pid\");\r\n            var interval = $(this).data(\"interval\");\r\n            var periodicity = $(this).data(\"periodicity\");\r\n            var quantity;\r\n            if ($(\".quantity input\").length !== 0) {\r\n                quantity = Number($(\".quantity input\").val());\r\n            } else {\r\n                quantity = $(this).data(\"quantity\");\r\n            }\r\n            if (quantity > 0) {\r\n                if (document.getElementById(\"errormsg-quantity\") !== null) {\r\n                    document.getElementById(\"errormsg-quantity\").innerHTML = \"<h4><h4>\";\r\n                }\r\n                var $container = SmartOrderRefill.creatContainer(\"#addproductPDP\");\r\n                var options = SmartOrderRefill.ModalOptions.addProductPDPOptions;\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: link,\r\n                    data: {\r\n                        subIDs: subIDs,\r\n                        pid: pid,\r\n                        interval: interval,\r\n                        periodicity: periodicity,\r\n                        quantity: quantity\r\n                    }\r\n                }).done(function (data) {\r\n                    if (data) {\r\n                        $container.html(data);\r\n                        SmartOrderRefill.createModal($container, options);\r\n                    }\r\n                });\r\n            } else {\r\n                document.getElementById(\"errormsg-quantity\").innerHTML = \"<h4>Quantity must be a integer grater then 0<h4>\";\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"product:afterAddToCart\", function (e, response) {\r\n            if (!response.error) {\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: SmartOrderRefillSettings.Urls.updateRefillData,\r\n                    data: {\r\n                        action: \"update\",\r\n                        hasSmartOrderRefill: $(\"[name=\\\"hasSmartOrderRefill\\\"]\").filter(\":checked\").val(),\r\n                        everyDelivery: $(\"[name=\\\"everyDelivery\\\"]\").val(),\r\n                        SorDeliveryWeekInterval: $(\"[name=\\\"SorDeliveryWeekInterval\\\"]\").val(),\r\n                        SorDeliveryMonthInterval: $(\"[name=\\\"SorDeliveryMonthInterval\\\"]\").val(),\r\n                        liuuid: response.pliUUID\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        $(\"body\").on(\"product:afterAttributeSelect\", function (e, response) {\r\n            if (response.data && response.data.product && response.data.product.id) {\r\n                $.ajax({\r\n                    type: \"GET\",\r\n                    url: SmartOrderRefillSettings.Urls.updatePDPOptions,\r\n                    data: {\r\n                        pid: response.data.product.id\r\n                    },\r\n                    success: function (successResponse) {\r\n                        var refillOptions = $(successResponse).filter(\".smart-order-refill-options\");\r\n\r\n                        var hasRefillId = \"#\" + refillOptions.find(\"[name=\\\"hasSmartOrderRefill\\\"]\").filter(\":checked\").attr(\"id\");\r\n                        var everyDelivery = refillOptions.find(\"[name=\\\"everyDelivery\\\"]\").val();\r\n                        var weekInterval = refillOptions.find(\"[name=\\\"SorDeliveryWeekInterval\\\"]\").val();\r\n                        var monthInterval = refillOptions.find(\"[name=\\\"SorDeliveryMonthInterval\\\"]\").val();\r\n\r\n                        var sorPrice = refillOptions.find(\".sor-price\");\r\n                        var sorPriceMessage = refillOptions.find(\".sor-price-message\");\r\n\r\n                        $(\"[name=\\\"everyDelivery\\\"]\").val(everyDelivery).change();\r\n                        $(\"[name=\\\"SorDeliveryWeekInterval\\\"]\").val(weekInterval).change();\r\n                        $(\"[name=\\\"SorDeliveryMonthInterval\\\"]\").val(monthInterval).change();\r\n                        $(\".smart-order-refill-options .sor-price\").remove();\r\n                        $(\".smart-order-refill-options .sor-price-message\").remove();\r\n                        if (sorPrice.length) {\r\n                            $(\".smart-order-refill-options\").append(sorPrice);\r\n                            $(\".smart-order-refill-options\").append(sorPriceMessage);\r\n                        }\r\n                        $(hasRefillId).prop(\"checked\", true).change();\r\n                        initOptions();\r\n                        hideOrShowSchedules($(\"input[name=hasSmartOrderRefill]:checked\").val());\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        hideOrShowSchedules($(\"input[name=hasSmartOrderRefill]:checked\").val());\r\n    };\r\n\r\n    \r\n    // generic method for functions without Ajax calls\r\n    SmartOrderRefill.initLinkModel = function () {\r\n        $(document).off(\"click\", \".sorshowmodal\").on(\"click\", \".sorshowmodal\", function (e) {\r\n            e.preventDefault();\r\n            var url = $(this).attr(\"data-link\");\r\n            var title = $(this).attr(\"data-title\");\r\n            var content = $(this).attr(\"data-content\");\r\n            var yes = $(this).attr(\"data-yes\");\r\n            var no = $(this).attr(\"data-no\");\r\n            var $container = SmartOrderRefill.creatContainer(\"#link-model\");\r\n            var options = {\r\n                autoOpen: true,\r\n                modal: true,\r\n                title: title,\r\n                width: \"25rem\",\r\n                buttons: {}\r\n            };\r\n\r\n            if (yes) {\r\n                options.buttons[yes] = SmartOrderRefill.ButtonFunctions.linkModelYes.bind($container, url);\r\n            }\r\n            if (no) {\r\n                options.buttons[no] = SmartOrderRefill.closeModal;\r\n            }\r\n            $container.html(\"<h3>\" + content + \"</h3>\");\r\n\r\n            SmartOrderRefill.createModal($container, options);\r\n        });\r\n    };\r\n\r\n    // generic method for error messages\r\n    SmartOrderRefill.initErrorModal = function (content, refresPage) {\r\n        var $container = SmartOrderRefill.creatContainer(\"#error-model\");\r\n        var options = {\r\n            autoOpen: true,\r\n            modal: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_ERROR_TITLE,\r\n            width: \"25rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_OK: SmartOrderRefill.ButtonFunctions.reloadDashboard.bind($container, refresPage)\r\n            }\r\n        };\r\n\r\n        $container.html(\"<h3>\" + content + \"</h3>\");\r\n        SmartOrderRefill.createModal($container, options);\r\n    };\r\n\r\n\r\n    // ***** BUTTONS FUNCTIONS ******\r\n    SmartOrderRefill.ButtonFunctions = {\r\n        // reactivateSubscription\r\n        reactivateSubscriptionSave: function () {\r\n            var $form = $(\"#reactiveSubs\");\r\n            var formValid = SmartOrderRefill.validateForm($form);\r\n            if ($form) {\r\n                if (formValid) {\r\n                    setTimeout(function () {\r\n                        $.ajax({\r\n                            type: \"POST\",\r\n                            url: $form.attr(\"action\"),\r\n                            data: $form.serialize()\r\n                        }).done(function (response) {\r\n                            if (response && response.success) {\r\n                                SmartOrderRefill.closeModal();\r\n                                window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                            } else {\r\n                                SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                            }\r\n                        }).fail(function () {\r\n                            SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                        });\r\n                    }, 1000);\r\n                }\r\n            }\r\n        },\r\n        reloadDashboard: function (refresPage) {\r\n            if (refresPage) {\r\n                window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n            }\r\n        },\r\n        // initReactivateOrderView\r\n        reactivateOrderViewOk: function () {\r\n            setTimeout(function () {\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: SmartOrderRefillSettings.Urls.cancelOneOrder,\r\n                    data: {\r\n                        sid: order // eslint-disable-line no-undef\r\n                    }\r\n                }).done(function (response) {\r\n                    if (response && response.success) {\r\n                        SmartOrderRefill.closeModal();\r\n                        window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }, 1000);\r\n        },\r\n\r\n        linkModelYes: function (url) {\r\n            $.ajax({\r\n                type: \"GET\",\r\n                url: url,\r\n                success: function (response) {\r\n                    if (response) {\r\n                        if (response.success) {\r\n                            window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                        } else if (response.message) {\r\n                            SmartOrderRefill.initErrorModal(response.message, true);\r\n                        } else {\r\n                            SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, true);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            SmartOrderRefill.closeModal();\r\n        },\r\n\r\n        // initUpdateCreditCardForm\r\n        updateCreditCardFormSave: function () {\r\n            var $form = $(\"#editCreditCard\");\r\n            var formValid = SmartOrderRefill.validateForm($form);\r\n            var today = new Date();\r\n            today.setHours(0, 0, 0);\r\n            var expirationDate = new Date();\r\n            var year = parseInt($form.find(\"[name$='updatecard_expiration_year']\").val(), 10);\r\n            var month = parseInt($form.find(\"[name$='updatecard_expiration_month']\").val(), 10);\r\n            if (year && month) {\r\n                expirationDate.setMonth(month - 1);\r\n                expirationDate.setFullYear(year);\r\n                expirationDate.setHours(0, 0, 0);\r\n                if (expirationDate.getTime() <= today.getTime()) {\r\n                    formValid = false;\r\n                    alert(SmartOrderRefillSettings.Resources.SOR_CREDITCARD_ERROR); // NOSONAR\r\n                }\r\n            }\r\n\r\n            if (formValid) {\r\n                if ($form.find(\".choose-card-wrapper\").length >= 0) {\r\n                    var $cardSelects = $(\"#editCreditCard\").find(\"[name$=\\\"updatecard_confirm\\\"]\");\r\n                    if ($form.find(\"[name$=\\\"updatecard_confirm\\\"]\").filter(\":checked\").length) {\r\n                        $cardSelects.each(function () {\r\n                            var $cardSelect = $(this);\r\n                            if (!$cardSelect.prop(\"checked\")) {\r\n                                $cardSelect.parents(\".choose-card-item\").remove();\r\n                            }\r\n                        });\r\n                    }\r\n                    setTimeout(function () {\r\n                        $.ajax({\r\n                            type: \"POST\",\r\n                            url: $form.attr(\"action\"),\r\n                            data: $form.serialize()\r\n                        }).done(function (response) {\r\n                            if (response && response.success) {\r\n                                SmartOrderRefill.closeModal();\r\n                                window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                            } else {\r\n                                alert(SmartOrderRefillSettings.Resources.SOR_CREDITCARD_ERROR); // NOSONAR\r\n                            }\r\n                        }).fail(function () {\r\n                            alert(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR); // NOSONAR\r\n                        });\r\n                    }, 1000);\r\n                }\r\n            }\r\n        },\r\n        addProductFormPDPSave: function () {\r\n            var $form = $(\"#addProductPDPForm\");\r\n            var formValid = SmartOrderRefill.validateForm($form);\r\n            var sid = $(\"input[name=sor-subs]:checked\").val();\r\n            var interval = $(\".addFromPDP\").data(\"interval\");\r\n            var periodicity = $(\".addFromPDP\").data(\"periodicity\");\r\n            var pid = $(\".addFromPDP\").data(\"pid\");\r\n            var quantity = $(\".addFromPDP\").data(\"quantity\");\r\n            if (formValid) {\r\n                setTimeout(function () {\r\n                    $.ajax({\r\n                        type: \"POST\",\r\n                        url: $form.attr(\"action\"),\r\n                        data: {\r\n                            periodicity: periodicity,\r\n                            interval: interval,\r\n                            pid: pid,\r\n                            quantity: quantity,\r\n                            sid: sid\r\n                        }\r\n                    }).done(function (data) {\r\n                        if (data) {\r\n                            if (data.success === true) {\r\n                                SmartOrderRefill.closeModal();\r\n                                window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                            }\r\n                        }\r\n                    });\r\n                }, 1000);\r\n            }\r\n        },\r\n        addProductFormSave: function () {\r\n            var $form = $(\"#addProductForm\");\r\n            var formValid = SmartOrderRefill.validateForm($form);\r\n            var variation = $form.find(\"[name$='addproduct_variation']\").val();\r\n            var periodicity = $form.find(\"[name$='addproduct_periodicity']\").val();\r\n            var interval = $form.find(\"[name$='addproduct_interval']\").val();\r\n            var quantity = $form.find(\"[name$='addproduct_quantity']\").val();\r\n            if (formValid) {\r\n                setTimeout(function () {\r\n                    $.ajax({\r\n                        type: \"POST\",\r\n                        url: $form.attr(\"action\"),\r\n                        data: {\r\n                            periodicity: periodicity,\r\n                            interval: interval,\r\n                            pid: variation,\r\n                            quantity: quantity\r\n                        }\r\n                    }).done(function (data) {\r\n                        if (data) {\r\n                            if (data.success === true) {\r\n                                SmartOrderRefill.closeModal();\r\n                                window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                            }\r\n                        }\r\n                    });\r\n                }, 1000);\r\n            }\r\n        },\r\n        // initChangeProductForm\r\n        changeProductFormSave: function () {\r\n            var $form = $(\"#editProductForm\");\r\n            var product = $(\".product-select\").val();\r\n\r\n            setTimeout(function () {\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: $form.attr(\"action\"),\r\n                    data: {\r\n                        newProduct: product\r\n                    }\r\n                }).done(function (response) {\r\n                    if (response && response.success) {\r\n                        SmartOrderRefill.closeModal.call($container); // eslint-disable-line no-undef\r\n                        window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                    } else {\r\n                        alert(SmartOrderRefillSettings.Resources.SOR_PRODUCT_ERROR); // NOSONAR\r\n                    }\r\n                }).fail(function () {\r\n                    SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                });\r\n            }, 1000);\r\n        },\r\n\r\n        // initAddressChangeForm\r\n        addressChangeFormSave: function () {\r\n            var $form = $(\"#editAddressForm\");\r\n            var formValid = SmartOrderRefill.validateForm($form);\r\n            var target = SmartOrderRefill.addressChangeInfo.target;\r\n            var urlview = SmartOrderRefill.addressChangeInfo.urlview;\r\n            var $container = SmartOrderRefill.addressChangeInfo.container;\r\n\r\n            setTimeout(function () {\r\n                if (!formValid) {\r\n                    return;\r\n                }\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: $form.attr(\"action\"),\r\n                    data: $form.serialize()\r\n                }).done(function (response) {\r\n                    if (response) {\r\n                        if (response.success) {\r\n                            var bootstrapModalBody = $(target).find(\".modal .modal-body\");\r\n                            if (bootstrapModalBody.length > 0) {\r\n                                target = bootstrapModalBody;\r\n                            }\r\n                            $(target).load(urlview, function () {\r\n                                SmartOrderRefill.limitCharacters();\r\n                            });\r\n                            SmartOrderRefill.closeModal.call($container);\r\n                        } else if ($(\"input[name$=\\\"_postal\\\"]:invalid\").length) {\r\n                            $(\"input[name$=\\\"_postal\\\"]\").parent().append(\"<label class=\\\"error\\\">\" + SmartOrderRefillSettings.Resources.INVALID_ZIP + \"</label>\");\r\n                        }\r\n                    } else {\r\n                        alert(SmartOrderRefillSettings.Resources.SOR_ADDRESS_ERROR); // NOSONAR\r\n                    }\r\n                }).fail(function () {\r\n                    alert(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR); // NOSONAR\r\n                });\r\n            }, 1000);\r\n        },\r\n\r\n        modifyRefillUpdate: function () {\r\n            var url = $(\"#modify-smart-order-refill form\").attr(\"action\");\r\n            var data = {\r\n                hasSmartOrderRefill: $(\"[name=\\\"hasSmartOrderRefill\\\"]\").filter(\":checked\").val(),\r\n                everyDelivery: $(\"[name=\\\"everyDelivery\\\"]\").val(),\r\n                SorDeliveryWeekInterval: $(\"[name=\\\"SorDeliveryWeekInterval\\\"]\").val(),\r\n                SorDeliveryMonthInterval: $(\"[name=\\\"SorDeliveryMonthInterval\\\"]\").val()\r\n            };\r\n            $.ajax({\r\n                type: \"POST\",\r\n                url: url,\r\n                data: data,\r\n                success: function (response) {\r\n                    if (response && response.success) {\r\n                        window.location = SmartOrderRefillSettings.Urls.cartShow;\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n\r\n    // ******  OPTIONS  *******\r\n\r\n    SmartOrderRefill.ModalOptions = {\r\n        // initaddProductPDPView\r\n        addProductPDPOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_ADD_PRODUCT_TITLE,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"25rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.addProductFormPDPSave\r\n            }\r\n        },\r\n        // initReactivateSubscriptionView\r\n        reactivateSubscriptionOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_REACTIVE_SUBSCRIPTION_TITLE,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"25rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.reactivateSubscriptionSave\r\n            }\r\n        },\r\n\r\n        // initReactivateOrderView\r\n        reactivateOrderViewOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_REACTIVE_ORDER_TITLE,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"25rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_OK: SmartOrderRefill.ButtonFunctions.reactivateOrderViewOk\r\n            }\r\n        },\r\n\r\n        // initUpdateCreditCardForm\r\n        updateCreditCardFormOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_UPDATE_CREDIT_CARD_TITLE,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"37.5rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.updateCreditCardFormSave\r\n            }\r\n        },\r\n        // initAddProduct\r\n        addProductOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_ADD_PRODUCT_TITLE,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"25rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.addProductFormSave\r\n            }\r\n        },\r\n        // initChangeProductForm\r\n        changeProductFormOptions: {\r\n            autoOpen: true,\r\n            bgiframe: true,\r\n            modal: true,\r\n            emptyOnClose: false,\r\n            width: \"25rem\",\r\n            title: \"Change product\",\r\n            buttons: {\r\n                SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.changeProductFormSave\r\n            }\r\n        },\r\n        // initSubscriptionView\r\n        subscriptionViewOptions: {\r\n            autoOpen: true,\r\n            modal: true,\r\n            dialogClass: \"smart-order-refill-modal\",\r\n            width: \"43.75rem\",\r\n            title: SmartOrderRefillSettings.Resources.SOR_DIALOG_SUBSCRIPTION,\r\n            buttons: {\r\n                SOR_GLOBAL_CLOSE: SmartOrderRefill.closeModal\r\n            }\r\n        },\r\n        // initOrderView\r\n        orderViewOptions: {\r\n            draggable: false,\r\n            resizable: false,\r\n            dialogClass: \"smart-order-refill-modal\",\r\n            autoOpen: true,\r\n            modal: true,\r\n            width: \"43.75rem\",\r\n            title: SmartOrderRefillSettings.Resources.SOR_DIALOG_ORDER,\r\n            buttons: {\r\n                SOR_GLOBAL_CLOSE: SmartOrderRefill.closeModal\r\n            }\r\n        },\r\n        modifyRefillOptions: {\r\n            draggable: false,\r\n            resizable: false,\r\n            dialogClass: \"smart-order-refill-modal\",\r\n            modal: true,\r\n            title: SmartOrderRefillSettings.Resources.SOR_MODIFY_SMART_ORDER_REFILL,\r\n            width: \"37.5rem\",\r\n            buttons: {\r\n                SOR_GLOBAL_UPDATE: SmartOrderRefill.ButtonFunctions.modifyRefillUpdate\r\n            }\r\n        },\r\n        // initAddressChangeForm\r\n        addressChangeFormOptions: function (target, urlview, $container) {\r\n            SmartOrderRefill.addressChangeInfo = {\r\n                target: target,\r\n                urlview: urlview,\r\n                container: $container\r\n            };\r\n            return {\r\n                autoOpen: true,\r\n                bgiframe: true,\r\n                modal: true,\r\n                emptyOnClose: false,\r\n                width: \"25rem\",\r\n                title: \"Change address\",\r\n                buttons: {\r\n                    SOR_GLOBAL_CANCEL: SmartOrderRefill.closeModal,\r\n                    SOR_GLOBAL_SAVE: SmartOrderRefill.ButtonFunctions.addressChangeFormSave\r\n                }\r\n            };\r\n        },\r\n        linkModelYes: function (url) {\r\n            $.ajax({\r\n                type: \"GET\",\r\n                url: url,\r\n                success: function (response) {\r\n                    if (response && response.success) {\r\n                        window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                    } else {\r\n                        SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, false);\r\n                    }\r\n                }\r\n            });\r\n            SmartOrderRefill.closeModal(this);\r\n        }\r\n\r\n    };\r\n\r\n\r\n    SmartOrderRefill.initAccountSorView = function () {\r\n        $(\".show-hide-orders\").each(function () {\r\n            $(this).on(\"click\", function () {\r\n                $(this).closest(\".subscriptionSection\").find(\".subscriptionOrders\").slideToggle(\"slow\");\r\n            });\r\n        });\r\n    };\r\n    \r\n    \r\n    SmartOrderRefill.initSkipNextShipment = function (){\r\n    \t$(document).on(\"click\", \"#skipnextshipment\", function (e) {\r\n    \t\tvar url = $(this).attr(\"data-link\");\r\n    \t\t$.ajax({\r\n                type: \"GET\",\r\n                url: url,\r\n                success: function (response) {\r\n                    if (response) {\r\n                        if (response.success) {\r\n                            window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                        } else if (response.message) {\r\n                            SmartOrderRefill.initErrorModal(response.message, true);\r\n                        } else {\r\n                            SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, true);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n    \t});\r\n    };\r\n    \r\n    SmartOrderRefill.cancelSubscription = function (){\r\n    \t$(document).on(\"click\", \"#cancelsubscription\", function (e) {\r\n    \t\tvar url = $(this).attr(\"data-link\");\r\n    \t\t$.ajax({\r\n                type: \"GET\",\r\n                url: url,\r\n                success: function (response) {\r\n                    if (response) {\r\n                        if (response.success) {\r\n                            window.location = SmartOrderRefillSettings.Urls.manageOrders;\r\n                        } else if (response.message) {\r\n                            SmartOrderRefill.initErrorModal(response.message, true);\r\n                        } else {\r\n                            SmartOrderRefill.initErrorModal(SmartOrderRefillSettings.Resources.SOR_UNEXPECTED_ERROR, true);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n    \t});\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     * @function\r\n     * @description Binds events to the cart page (edit item's details, bonus item's actions, coupon code entry)\r\n     */\r\n    SmartOrderRefill.initialize = function () {\r\n        SmartOrderRefill.initSubscriptionView();\r\n        SmartOrderRefill.initOrderView();\r\n        SmartOrderRefill.initAddressChangeForm();\r\n        SmartOrderRefill.initCreditCardExpirationWarning();\r\n        SmartOrderRefill.initChangeProductForm();\r\n        SmartOrderRefill.initReactivateSubscriptionView();\r\n        SmartOrderRefill.initReactivateOrderView();\r\n        SmartOrderRefill.initUpdateProductQuantity();\r\n        SmartOrderRefill.initRemoveProduct();\r\n        SmartOrderRefill.initUpdateRefill();\r\n        SmartOrderRefill.initModifyRefill();\r\n        SmartOrderRefill.initRemoveRefill();\r\n        SmartOrderRefill.initLoginFromCart();\r\n        SmartOrderRefill.initLinkModel();\r\n\r\n        SmartOrderRefill.initializePdp();\r\n        SmartOrderRefill.initAccountSorView();\r\n        SmartOrderRefill.initSkipNextShipment();\r\n        SmartOrderRefill.cancelSubscription();\r\n    };\r\n\r\n    $(document).ready(function () {\r\n        SmartOrderRefill.initialize();\r\n        if (typeof $.fn.dialog !== \"undefined\") {\r\n            SmartOrderRefillSettings.ModalType = \"dialog\";\r\n        } else if (typeof $.fn.modal !== \"undefined\") {\r\n            SmartOrderRefillSettings.ModalType = \"modal\";\r\n        }\r\n\r\n        $(\".sorlink.visually-hidden\").removeClass(\"visually-hidden\");\r\n        \r\n        //initializing date picker\r\n        $('.modifydatepicker').each(function(){\r\n        \tvar defDate = new Date($(this).val());\r\n        \tvar maxDate = new Date(defDate);\r\n        \t$(this).datepicker({\r\n        \t\tdateFormat: 'mm/dd/yy',\r\n        \t\tshowOtherMonths: true,\r\n                minDate: 2,\r\n                maxDate: new Date(maxDate.setDate(maxDate.getDate() + 120)),\r\n                dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\r\n                defaultDate: defDate,\r\n                //beforeShowDay: noWeekendsOrHolidays\r\n            });\r\n        });\r\n        \r\n        window.SmartOrderRefill = SmartOrderRefill;\r\n    });\r\n}(window.jQuery));\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbnRfc21hcnRvcmRlcnJlZmlsbC9jYXJ0cmlkZ2UvY2xpZW50L2RlZmF1bHQvanMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWNvbmNhdCAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1hbGVydCAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLXN5bnRheCwgZ3VhcmQtZm9yLWluLCBuby1wYXJhbS1yZWFzc2lnbiwqL1xyXG5cInVzZSBzdHJpY3RcIjtcclxuLyogZ2xvYmFsIFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncywgalF1ZXJ5ICovXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgLyoqXHJcbiAgICAgKiAgUHJvcGVydHkgb2YgT1NGIEdsb2JhbCBTZXJ2aWNlcywgSW5jLiwgKHdpdGggaXRzIGJyYW5kIE9TRiBDb21tZXJjZSkuIE9TRiByZW1haW5zIHRoZSBzb2xlIG93bmVyIG9mIGFsbCByaWdodCwgdGl0bGUgYW5kIGludGVyZXN0IGluIHRoZSBzb2Z0d2FyZS5cclxuICAgICAqICBEbyBub3QgY29weSwgc2VsbCwgcmV2ZXJzZSBlbmdpbmVlciBvciBvdGhlcndpc2UgYXR0ZW1wdCB0byBkZXJpdmUgb3Igb2J0YWluIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmdW5jdGlvbmluZywgbWFudWZhY3R1cmUgb3Igb3BlcmF0aW9uIHRoZXJlaW4uXHJcbiAgICAgKi9cclxuICAgIC8qICoqKioqIFN0YXJ0IG9mIFV0aWwgc2VjdGlvbiAqKioqKiAqL1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gU21hcnRPcmRlclJlZmlsbCBjb25zdHJ1Y3RvclxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBTbWFydE9yZGVyUmVmaWxsKCkge31cclxuXHJcbiAgICAvLyBGb3JtIFZhbGlkYXRpb25cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwudmFsaWRhdGVGb3JtID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgZm9ybVZhbGlkID0gdHJ1ZTtcclxuICAgICAgICBlbGVtZW50LmZpbmQoXCIuZmllbGQtd3JhcHBlclwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGZpZWxkV3JhcHBlciA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZCA9IGZpZWxkV3JhcHBlci5maW5kKFwiaW5wdXQsIHNlbGVjdFwiKTtcclxuICAgICAgICAgICAgaWYgKGZpZWxkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiZXJyb3JcIik7XHJcbiAgICAgICAgICAgICAgICBmaWVsZFdyYXBwZXIuZmluZChcImxhYmVsLmVycm9yXCIpLmFkZENsYXNzKFwiaGlkZVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWxpZFN0YXRlID0gZmllbGRbMF0udmFsaWRpdHk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF2YWxpZFN0YXRlLnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybVZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQuYWRkQ2xhc3MoXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRTdGF0ZS52YWx1ZU1pc3NpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRXcmFwcGVyLmZpbmQoXCJsYWJlbC5lcnJvci5taXNzaW5nLWVycm9yXCIpLnJlbW92ZUNsYXNzKFwiaGlkZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZFdyYXBwZXIuZmluZChcImxhYmVsLmVycm9yLnZhbHVlLWVycm9yXCIpLnJlbW92ZUNsYXNzKFwiaGlkZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZm9ybVZhbGlkO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBDcmVhdGUgTW9kYWwgVXAgVG8gTW9kYWwgVHlwZVxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCA9IGZ1bmN0aW9uIChjb250YWluZXIsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucy5idXR0b25zICYmIE9iamVjdC5rZXlzKG9wdGlvbnMuYnV0dG9ucykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgYnV0dG9ucyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5idXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoXCJTT1JfR0xPQkFMX1wiKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uc1tTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzW2tleV1dID0gb3B0aW9ucy5idXR0b25zW2tleV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbnNba2V5XSA9IG9wdGlvbnMuYnV0dG9uc1trZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wdGlvbnMuYnV0dG9ucyA9IGJ1dHRvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuTW9kYWxUeXBlID09PSBcImRpYWxvZ1wiKSB7XHJcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5kaWFsb2cob3B0aW9ucyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5ib290c3RyYXBNb2RhbChjb250YWluZXIsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gR2VuZXJpYyBNb2RhbCBDbG9zZVxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuTW9kYWxUeXBlID09PSBcImRpYWxvZ1wiKSB7XHJcbiAgICAgICAgICAgICQodGhpcykuY2xvc2VzdChcIi51aS1kaWFsb2ctY29udGVudFwiKS5kaWFsb2coXCJjbG9zZVwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWwgPSAkKHRoaXMpLmNsb3Nlc3QoXCIubW9kYWxcIik7XHJcbiAgICAgICAgICAgIGlmIChtb2RhbC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIG1vZGFsID0gJCh0aGlzKS5maW5kKFwiLm1vZGFsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1vZGFsLm1vZGFsKFwiaGlkZVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEJvb3RzdHJhcCBNb2RhbFxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5ib290c3RyYXBNb2RhbCA9IGZ1bmN0aW9uIChjb250YWluZXIsIG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgYnV0dG9uc01hcmtVcCA9IFwiXCI7XHJcbiAgICAgICAgdmFyIHRpdGxlID0gb3B0aW9ucy50aXRsZSA/IG9wdGlvbnMudGl0bGUgOiBcIlwiO1xyXG4gICAgICAgIHZhciB3aWR0aCA9IG9wdGlvbnMud2lkdGggPyBcInN0eWxlPVxcXCJtYXgtd2lkdGg6XCIgKyBvcHRpb25zLndpZHRoICsgXCIhaW1wb3J0YW50O1xcXCJcIiA6IFwiXCI7XHJcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBvcHRpb25zLmJ1dHRvbnM7XHJcbiAgICAgICAgaWYgKGJ1dHRvbnMgJiYgT2JqZWN0LmtleXMoYnV0dG9ucykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBidXR0b25zTWFya1VwICs9IFwiPGRpdiBjbGFzcz1cXFwibW9kYWwtZm9vdGVyXFxcIj5cIjtcclxuICAgICAgICAgICAgJChjb250YWluZXIpLm9mZihcImNsaWNrXCIsIFwiI3Nvck1vZGFsQ2VudGVyIGJ1dHRvbi5hY3Rpb25cIik7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBidXR0b25zKSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25zTWFya1VwICs9IFwiPGJ1dHRvbiB0eXBlPVxcXCJidXR0b25cXFwiIGNsYXNzPVxcXCJidG4gYnRuLXByaW1hcnkgYWN0aW9uXFxcIiAgZGF0YS1pZD1cXFwiXCIgKyBrZXkgKyBcIlxcXCI+XCIgKyBrZXkgKyBcIjwvYnV0dG9uPlwiO1xyXG4gICAgICAgICAgICAgICAgJChjb250YWluZXIpLm9uKFwiY2xpY2tcIiwgXCIjc29yTW9kYWxDZW50ZXIgYnV0dG9uLmFjdGlvbltkYXRhLWlkPVxcXCJcIiArIGtleSArIFwiXFxcIl1cIiwgYnV0dG9uc1trZXldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBidXR0b25zTWFya1VwICs9IFwiPGRpdj5cIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBib290c3RyYXAgPSBgPGRpdiBjbGFzcz1cIm1vZGFsIGZhZGVcIiBpZD1cInNvck1vZGFsQ2VudGVyXCIgdGFiaW5kZXg9XCItMVwiIHJvbGU9XCJkaWFsb2dcIiBhcmlhLWxhYmVsbGVkYnk9XCJzb3JNb2RhbENlbnRlclwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiICR7d2lkdGh9ICByb2xlPVwiZG9jdW1lbnRcIj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8aDUgY2xhc3M9XCJtb2RhbC10aXRsZVwiIGlkPVwiZXhhbXBsZU1vZGFsTG9uZ1RpdGxlXCI+JHt0aXRsZX08L2g1PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImNsb3NlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPiZ0aW1lczs8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR7Y29udGFpbmVyLmh0bWwoKX1cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAke2J1dHRvbnNNYXJrVXB9XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+YDtcclxuICAgICAgICBjb250YWluZXIuaHRtbChib290c3RyYXApO1xyXG4gICAgICAgIGNvbnRhaW5lci5maW5kKFwiLm1vZGFsXCIpLm9uKFwic2hvd24uYnMubW9kYWxcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uTW9kYWxzID0gJChcIiNzdWJzY3JpcHRpb252aWV3LCAjb3JkZXJ2aWV3XCIpO1xyXG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uTW9kYWxzLmxlbmd0aCA+IDAgJiYgIWNvbnRhaW5lci5pcyhzdWJzY3JpcHRpb25Nb2RhbHMpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuc2libGluZ3MoXCIubW9kYWwtYmFja2Ryb3BcIikubGFzdCgpLmNzcyhcInotaW5kZXhcIiwgXCIxMDYwXCIpO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoXCIubW9kYWxcIikuY3NzKFwiei1pbmRleFwiLCBcIjEwNzBcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb250YWluZXIuZmluZChcIi5tb2RhbFwiKS5tb2RhbCh7XHJcbiAgICAgICAgICAgIGJhY2tkcm9wOiBcInN0YXRpY1wiXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmZpbmQoXCIubW9kYWxcIikubW9kYWwoXCJzaG93XCIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5maW5kKFwiLm1vZGFsXCIpLm9uKFwiaGlkZGVuLmJzLm1vZGFsXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBpZiAoJChcIiNzdWJzY3JpcHRpb252aWV3LCAjb3JkZXJ2aWV3LCAjZXJyb3ItbW9kZWxcIikubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoXCJtb2RhbC1vcGVuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwubGltaXRDaGFyYWN0ZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoXCJmb3JtXCIpLmZpbmQoXCJ0ZXh0YXJlYVtkYXRhLWNoYXJhY3Rlci1saW1pdF1cIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGFyYWN0ZXJMaW1pdCA9ICQodGhpcykuZGF0YShcImNoYXJhY3Rlci1saW1pdFwiKTtcclxuICAgICAgICAgICAgdmFyIGNoYXJDb3VudEh0bWwgPSBTdHJpbmcuZm9ybWF0KFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuQ0hBUl9MSU1JVF9NU0csXHJcbiAgICAgICAgICAgICAgICAgICAgXCI8c3BhbiBjbGFzcz1cXFwiY2hhci1yZW1haW4tY291bnRcXFwiPlwiICsgY2hhcmFjdGVyTGltaXQgKyBcIjwvc3Bhbj5cIixcclxuICAgICAgICAgICAgICAgICAgICBcIjxzcGFuIGNsYXNzPVxcXCJjaGFyLWFsbG93ZWQtY291bnRcXFwiPlwiICsgY2hhcmFjdGVyTGltaXQgKyBcIjwvc3Bhbj5cIik7XHJcbiAgICAgICAgICAgIHZhciBjaGFyQ291bnRDb250YWluZXIgPSAkKHRoaXMpLm5leHQoXCJkaXYuY2hhci1jb3VudFwiKTtcclxuICAgICAgICAgICAgaWYgKGNoYXJDb3VudENvbnRhaW5lci5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGNoYXJDb3VudENvbnRhaW5lciA9ICQoXCI8ZGl2IGNsYXNzPVxcXCJjaGFyLWNvdW50XFxcIi8+XCIpLmluc2VydEFmdGVyKCQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNoYXJDb3VudENvbnRhaW5lci5odG1sKGNoYXJDb3VudEh0bWwpO1xyXG4gICAgICAgICAgICAvLyB0cmlnZ2VyIHRoZSBrZXlkb3duIGV2ZW50IHNvIHRoYXQgYW55IGV4aXN0aW5nIGNoYXJhY3RlciBkYXRhIGlzIGNhbGN1bGF0ZWRcclxuICAgICAgICAgICAgJCh0aGlzKS5jaGFuZ2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdENvbnRhaW5lciA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xyXG4gICAgICAgIHZhciAkdGFyZ2V0O1xyXG4gICAgICAgIHZhciBpZDtcclxuICAgICAgICBpZiAoalF1ZXJ5LnR5cGUoc2VsZWN0b3IpID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3Rvci5pbmRleE9mKFwiI1wiKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgJHRhcmdldCA9ICQoc2VsZWN0b3IsIGRvY3VtZW50KTtcclxuICAgICAgICAgICAgICAgICR0YXJnZXQuc2VsZWN0b3IgPSBzZWxlY3RvcjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICR0YXJnZXQgPSAkKFwiI1wiICsgc2VsZWN0b3IsIGRvY3VtZW50KTtcclxuICAgICAgICAgICAgICAgICR0YXJnZXQuc2VsZWN0b3IgPSBcIiNcIiArIHNlbGVjdG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIGpRdWVyeSkge1xyXG4gICAgICAgICAgICAkdGFyZ2V0ID0gc2VsZWN0b3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJHRhcmdldCAmJiAkdGFyZ2V0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICBpZiAoJHRhcmdldC5zZWxlY3RvciAmJiAkdGFyZ2V0LnNlbGVjdG9yLmluZGV4T2YoXCIjXCIpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZCA9ICR0YXJnZXQuc2VsZWN0b3Iuc3Vic3RyKDEpO1xyXG4gICAgICAgICAgICAgICAgJHRhcmdldCA9ICQoXCI8ZGl2PlwiKS5hdHRyKFwiaWRcIiwgaWQpLmFwcGVuZFRvKFwiYm9keVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJHRhcmdldDtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjcmlwdGlvbiBnZXQgcGFyYW1ldGVyIHZhbHVlIGZyb20gdXJsXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIHVybCB0byBwYXJzXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBwYXJhbWV0ZXIgdG8gZmluZFxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gcGFyYW1lciB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBnZXRVUkxQYXJhbWV0ZXIodXJsLCBuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIChSZWdFeHAobmFtZSArIFwiPVwiICsgXCIoLis/KSgmfCQpXCIpLmV4ZWModXJsKSB8fCBbLCBudWxsXSlbMV07IC8vZXNsaW50LWRpc2FibGUtbGluZVxyXG4gICAgfVxyXG5cclxuICAgIC8qICoqKioqKiBFbmQgb2YgVXRpbCBzZWN0aW9uICoqKioqKiAqL1xyXG5cclxuXHJcbiAgICAvKiAqKioqKiogU3RhcnQgb2YgQWNjb3VudCBzZWN0aW9uICoqKioqKiogKi9cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9uIGZpbGwgQWRkcmVzcyBGaWVsZHNcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhZGRyZXNzIGFkZHJlc3Mgb2JqZWN0XHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gJGZvcm0gZm9ybSBvYmplY3RcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZmlsbEFkZHJlc3NGaWVsZHMoYWRkcmVzcywgJGZvcm0pIHtcclxuICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBhZGRyZXNzKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gXCJJRFwiIHx8IGZpZWxkID09PSBcIlVVSURcIiB8fCBmaWVsZCA9PT0gXCJrZXlcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnRpbnVlXHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkZm9ybS5maW5kKFwiW25hbWUkPVxcXCJcIiArIGZpZWxkLnJlcGxhY2UoXCJDb2RlXCIsIFwiXCIpICsgXCJcXFwiXVwiKS52YWwoYWRkcmVzc1tmaWVsZF0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkID09PSBcImNvdW50cnlDb2RlXCIpIHtcclxuICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoXCJbbmFtZSQ9XFxcImNvdW50cnlcXFwiXVwiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xyXG4gICAgICAgICAgICAgICAgJGZvcm0uZmluZChcIltuYW1lJD1cXFwic3RhdGVcXFwiXVwiKS52YWwoYWRkcmVzcy5zdGF0ZUNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gZmlsdGVyIHByb2R1Y3QgdmFyaWF0aW9uXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGZpbHRlclByb2R1Y3RWYXJpYW50cygpIHtcclxuICAgICAgICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI2R3ZnJtX2FkZHByb2R1Y3RfcHJvZHVjdFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFByb2R1Y3QgPSAkKHRoaXMpLmNoaWxkcmVuKFwib3B0aW9uOnNlbGVjdGVkXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICB2YXIgdmFyaWF0aW9ucyA9ICQoXCIjZHdmcm1fYWRkcHJvZHVjdF92YXJpYXRpb25cIikuY2hpbGRyZW4oXCJvcHRpb25cIik7XHJcbiAgICAgICAgICAgIHZhcmlhdGlvbnMuc2hvdygpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhcmlhdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YXJpYW50cyA9IHZhcmlhdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFyaWFudCA9ICQodmFyaWFudHMpLmRhdGEoXCJtYXN0ZXJcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRQcm9kdWN0ICE9PSB2YXJpYW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNkd2ZybV9hZGRwcm9kdWN0X3ZhcmlhdGlvblwiKS5jaGlsZHJlbihcIm9wdGlvbltkYXRhLW1hc3Rlcj1cIiArIFwiXFxcIlwiICsgdmFyaWFudCArIFwiXFxcIlwiICsgXCJdXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFByb2R1Y3QgPT09IHZhcmlhbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiI2R3ZnJtX2FkZHByb2R1Y3RfdmFyaWF0aW9uXCIpLmNoaWxkcmVuKFwib3B0aW9uXCIpLmZpbHRlcihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJCh0aGlzKS5kYXRhKFwibWFzdGVyXCIpID09PSBzZWxlY3RlZFByb2R1Y3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLnByb3AoXCJzZWxlY3RlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBAZGVzY3JpcHRpb24gZmlsdGVyIHByb2R1Y3QgaW50ZXJ2YWxzXHJcbiAgICAqL1xyXG4gICAgZnVuY3Rpb24gZmlsdGVyUHJvZHVjdFJlZmlsbCgpIHtcclxuICAgICAgICB2YXIgcGVyaW9kcyA9ICQoXCIjZHdmcm1fYWRkcHJvZHVjdF9wZXJpb2RpY2l0eVwiKS5jaGlsZHJlbihcIm9wdGlvblwiKTtcclxuXHJcbiAgICAgICAgaWYgKHBlcmlvZHMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAkKFwiI2R3ZnJtX2FkZHByb2R1Y3RfaW50ZXJ2YWxcIikuY2hpbGRyZW4oXCJvcHRpb25cIikuZmlsdGVyKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJCh0aGlzKS5kYXRhKFwicGVyaW9kaWNpdHlcIikgIT09IFwid2Vla1wiKTtcclxuICAgICAgICAgICAgfSkuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJChcIiNkd2ZybV9hZGRwcm9kdWN0X3BlcmlvZGljaXR5XCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkUGVyaW9kID0gJCh0aGlzKS5jaGlsZHJlbihcIm9wdGlvbjpzZWxlY3RlZFwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIGludGVydmFscyA9ICQoXCIjZHdmcm1fYWRkcHJvZHVjdF9pbnRlcnZhbFwiKS5jaGlsZHJlbihcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgaW50ZXJ2YWxzLnNob3coKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnRlcnZhbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcnZhbDIgPSBpbnRlcnZhbHNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJ2YWxQZXJpb2QgPSAkKGludGVydmFsMikuZGF0YShcInBlcmlvZGljaXR5XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkUGVyaW9kICE9PSBpbnRlcnZhbFBlcmlvZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2VsZXNzLWNvbmNhdFxyXG4gICAgICAgICAgICAgICAgICAgICQoXCIjZHdmcm1fYWRkcHJvZHVjdF9pbnRlcnZhbFwiKS5jaGlsZHJlbihcIm9wdGlvbltkYXRhLXBlcmlvZGljaXR5PVwiICsgXCJcXFwiXCIgKyBpbnRlcnZhbFBlcmlvZCArIFwiXFxcIlwiICsgXCJdXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEFkZHJlc3NDaGFuZ2VGb3JtID0gZnVuY3Rpb24gKHRhcmdldCwgdXJsdmlldykge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9mZihcImNsaWNrXCIsIFwiLmNoYW5nZWFkZHJlc3NcIikub24oXCJjbGlja1wiLCBcIi5jaGFuZ2VhZGRyZXNzXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIC8qaWYgKCFlLmRldGFpbCB8fCBlLmRldGFpbCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS11cmxcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9IFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRDb250YWluZXIoXCIjYWRkcmVzc2NoYW5nZVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gU21hcnRPcmRlclJlZmlsbC5Nb2RhbE9wdGlvbnMuYWRkcmVzc0NoYW5nZUZvcm1PcHRpb25zKHRhcmdldCwgdXJsdmlldywgJGNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGNvbnRhaW5lci5sb2FkKHVybCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRlTW9kYWwoJGNvbnRhaW5lciwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJChcIiNlZGl0QWRkcmVzc0Zvcm1cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoXCJzZWxlY3RbbmFtZSQ9XFxcIl9jaGFuZ2VhZGRyZXNzXFxcIl1cIiwgJGZvcm0pLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gJCh0aGlzKS5jaGlsZHJlbihcIjpzZWxlY3RlZFwiKS5maXJzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRBZGRyZXNzID0gJChzZWxlY3RlZCkuZGF0YShcImFkZHJlc3NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZWN0ZWRBZGRyZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbEFkZHJlc3NGaWVsZHMoc2VsZWN0ZWRBZGRyZXNzLCAkZm9ybSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwudmFsaWRhdGVGb3JtKCRmb3JtKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9Ki8gXHJcbiAgICAgICAgXHRcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICBcdCQoJy5sb2FkZXItcHJldmVudGl2ZScpLnNob3coKTtcclxuICAgICAgICAgXHR2YXIgdXJsID0gJCh0aGlzKS5hdHRyKCdkYXRhLXVybCcpO1xyXG4gICAgICAgICBcdCQuZ2V0KCB1cmwgLCBmdW5jdGlvbiggZGF0YSApIHtcclxuICAgICAgICAgXHQgICQoJyNhZGRyZXNzTW9kYWwgLm1vZGFsLWNvbnRlbnQnKS5odG1sKGRhdGEpO1xyXG4gICAgICAgICBcdCAgJCgnI2FkZHJlc3NNb2RhbCcpLm1vZGFsKCdzaG93Jyk7XHJcbiAgICAgICAgIFx0ICAkKCcubG9hZGVyLXByZXZlbnRpdmUnKS5oaWRlKCk7XHJcbiAgICAgICAgIFx0fSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2lucHV0W25hbWU9XCJkd2ZybV9jaGFuZ2VhZGRyZXNzXCJdJywgZnVuY3Rpb24oKXtcclxuXHRcdFx0JCgnLnJhZGlvLWNoYW5nZWFkZHJlc3MnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcclxuXHRcdFx0JCh0aGlzKS5wYXJlbnRzKCcucmFkaW8tY2hhbmdlYWRkcmVzcycpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xyXG5cdFx0fSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqIEBmdW5jdGlvblxyXG4gICAgICogQGRlc2NyaXB0aW9uIGluaXRpYWxpemUgZGlhbG9nIGZvciBvcmRlciB2aWV3XHJcbiAgICAgKi9cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdE9yZGVyVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKFwiLm9yZGVyLnZpZXdcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSBTbWFydE9yZGVyUmVmaWxsLmNyZWF0Q29udGFpbmVyKFwiI29yZGVydmlld1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkY29udGFpbmVyLmxvYWQodXJsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5saW1pdENoYXJhY3RlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNyZWF0ZU1vZGFsKCRjb250YWluZXIsIFNtYXJ0T3JkZXJSZWZpbGwuTW9kYWxPcHRpb25zLm9yZGVyVmlld09wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEFkZHJlc3NDaGFuZ2VGb3JtKFwiI29yZGVydmlld1wiLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSBkaWFsb2cgZm9yIHN1YnNjcmlwdGlvbiB2aWV3XHJcbiAgICAgKi9cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdFN1YnNjcmlwdGlvblZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChcIi5zdWJzY3JpcHRpb24udmlld1wiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICghZS5kZXRhaWwgfHwgZS5kZXRhaWwgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWxpbmtcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9IFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRDb250YWluZXIoXCIjc3Vic2NyaXB0aW9udmlld1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkY29udGFpbmVyLmxvYWQodXJsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5saW1pdENoYXJhY3RlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNyZWF0ZU1vZGFsKCRjb250YWluZXIsIFNtYXJ0T3JkZXJSZWZpbGwuTW9kYWxPcHRpb25zLnN1YnNjcmlwdGlvblZpZXdPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRBZGRyZXNzQ2hhbmdlRm9ybShcIiNzdWJzY3JpcHRpb252aWV3XCIsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0VXBkYXRlQ3JlZGl0Q2FyZEZvcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRBZGRQcm9kdWN0Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSB1cGRhdGUgcHJvZHVjdCBxdWFudGl0eVxyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRVcGRhdGVQcm9kdWN0UXVhbnRpdHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi51cGRhdGUtaXRlbVwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICQodGhpcykuYXR0cihcImRhdGEtbGlua1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gZ2V0VVJMUGFyYW1ldGVyKHVybCwgXCJpdGVtXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHF1YW50aXR5ID0gJCh0aGlzKS5wYXJlbnRzKFwiLm9yZGVyLXNlY3Rpb25cIikuZmluZChcIiNxdWFudGl0eV9cIiArIGl0ZW0pLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiBxdWFudGl0eVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKFwiI3F0eUVycm9yXCIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNxdHlFcnJvclwiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlVybHMubWFuYWdlT3JkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCEkKFwiI3F0eUVycm9yXCIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxsYWJlbCBjbGFzcz1cXFwiZXJyb3JcXFwiIGlkPVxcXCJxdHlFcnJvclxcXCI+XCIgKyByZXNwb25zZS5tZXNzYWdlICsgXCI8L2xhYmVsPlwiKS5pbnNlcnRBZnRlcihcIiNxdWFudGl0eV9cIiArIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9RVUFOVElUWV9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSByZW1vdmUgcHJvZHVjdFxyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRSZW1vdmVQcm9kdWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucmVtb3ZlLWl0ZW1cIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlLmRldGFpbCB8fCBlLmRldGFpbCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICQodGhpcykuYXR0cihcImRhdGEtbGlua1wiKTtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmxcclxuICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlVybHMubWFuYWdlT3JkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfUVVBTlRJVFlfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSBkaWFsb2cgZm9yIGFkZCBwcm9kdWN0XHJcbiAgICAgKi9cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEFkZFByb2R1Y3RGb3JtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9mZihcImNsaWNrXCIsIFwiLmFkZHByb2R1Y3RcIikub24oXCJjbGlja1wiLCBcIi5hZGRwcm9kdWN0XCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICghZS5kZXRhaWwgfHwgZS5kZXRhaWwgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWxpbmtcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9IFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRDb250YWluZXIoXCIjYWRkcHJvZHVjdFwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gU21hcnRPcmRlclJlZmlsbC5Nb2RhbE9wdGlvbnMuYWRkUHJvZHVjdE9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAkY29udGFpbmVyLmxvYWQodXJsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJQcm9kdWN0VmFyaWFudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJQcm9kdWN0UmVmaWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNkd2ZybV9hZGRwcm9kdWN0X3Byb2R1Y3RcIikudHJpZ2dlcihcImNsaWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSBjaGFuZ2UgcHJvZHVjdCBmb3JtXHJcbiAgICAgKi9cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdENoYW5nZVByb2R1Y3RGb3JtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9mZihcImNsaWNrXCIsIFwiLmNoYW5nZS1pdGVtXCIpLm9uKFwiY2xpY2tcIiwgXCIuY2hhbmdlLWl0ZW1cIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlLmRldGFpbCB8fCBlLmRldGFpbCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICQodGhpcykuYXR0cihcImRhdGEtbGlua1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gU21hcnRPcmRlclJlZmlsbC5jcmVhdENvbnRhaW5lcihcIiNjaGFuZ2Vwcm9kdWN0XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBTbWFydE9yZGVyUmVmaWxsLk1vZGFsT3B0aW9ucy5jaGFuZ2VQcm9kdWN0Rm9ybU9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgJGNvbnRhaW5lci5sb2FkKHVybCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRlTW9kYWwoJGNvbnRhaW5lciwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAZnVuY3Rpb25cclxuICAgICAqIEBkZXNjcmlwdGlvbiBpbml0aWFsaXplIGRpYWxvZyBmb3IgdXBkYXRlIGNyZWRpdCBjYXJkIHZpZXdcclxuICAgICAqL1xyXG4gICAgU21hcnRPcmRlclJlZmlsbC5pbml0VXBkYXRlQ3JlZGl0Q2FyZEZvcm0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChkb2N1bWVudCkub2ZmKFwiY2xpY2tcIiwgXCIudXBkYXRlLWNhcmRcIikub24oXCJjbGlja1wiLCBcIi51cGRhdGUtY2FyZFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSBTbWFydE9yZGVyUmVmaWxsLmNyZWF0Q29udGFpbmVyKFwiI3VwZGF0ZWNyZWRpdGNhcmRcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IFNtYXJ0T3JkZXJSZWZpbGwuTW9kYWxPcHRpb25zLnVwZGF0ZUNyZWRpdENhcmRGb3JtT3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICAkY29udGFpbmVyLmxvYWQodXJsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiLmNob29zZS1jYXJkLWl0ZW1cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcImlucHV0W3R5cGU9XFxcInJhZGlvXFxcIl1cIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcInNlbGVjdFtpZCQ9J191cGRhdGVjYXJkX2V4cGlyYXRpb25fbW9udGgnXVwiKS52YWwocGFyc2VJbnQoJChcIiN1cGRhdGVjcmVkaXRjYXJkXCIpLmZpbmQoXCIuZXhwaXJhdGlvbi1kYXRlLXdyYXBwZXJcIikuYXR0cihcImRhdGEtZXhwbW9udGhcIiksIDEwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcInNlbGVjdFtpZCQ9J191cGRhdGVjYXJkX2V4cGlyYXRpb25feWVhciddXCIpLnZhbCgkKFwiI3VwZGF0ZWNyZWRpdGNhcmRcIikuZmluZChcIi5leHBpcmF0aW9uLWRhdGUtd3JhcHBlclwiKS5hdHRyKFwiZGF0YS1leHB5ZWFyXCIpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqIEBmdW5jdGlvblxyXG4gICAgICogQGRlc2NyaXB0aW9uIGluaXRpYWxpemUgdXBkYXRlIHJlZmlsbFxyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRVcGRhdGVSZWZpbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi51cGRhdGUtcmVmaWxsXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICghZS5kZXRhaWwgfHwgZS5kZXRhaWwgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWxpbmtcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGdldFVSTFBhcmFtZXRlcih1cmwsIFwiaXRlbVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBwZXJpb2RpY2l0eSA9ICQoXCIjc2VsZWN0LWV2ZXJ5ZGVsaXZlcnktXCIgKyBpdGVtKS52YWwoKTtcclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9IChwZXJpb2RpY2l0eSA9PT0gXCJtb250aFwiKSA/ICQoXCIjc29yTW9udGgtXCIgKyBpdGVtKS52YWwoKSA6ICQoXCIjc29yV2Vlay1cIiArIGl0ZW0pLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvck5leHREYXRlID0gJChcIiNzb3JOZXh0RGF0ZS1cIiArIGl0ZW0pLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmlvZGljaXR5OiBwZXJpb2RpY2l0eSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IGludGVydmFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3JOZXh0RGF0ZTogc29yTmV4dERhdGVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLm1hbmFnZU9yZGVycztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1FVQU5USVRZX0VSUk9SLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VTkVYUEVDVEVEX0VSUk9SLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAZnVuY3Rpb25cclxuICAgICAqIEBkZXNjcmlwdGlvbiBpbml0aWFsaXplIGNyZWRpdCBjYXJkIGV4cGlyYXRpb24gd2FybmluZ1xyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRDcmVkaXRDYXJkRXhwaXJhdGlvbldhcm5pbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQGRlc2NyaXB0aW9uIGRldGVybWluIGlmIGNhcmQgZXhwaXJhdGlvbiB3b3JuaW5nIHNob3VsZCBiZSBzaG93blxyXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb250aCBtb250aCBmb3JtIGVsZW1lbnQgdmFsdWVcclxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30geWVhciB5ZWFyIGZvcm0gZWxlbWVudCB2YWx1ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUV4cGlyYXRpb25XYXJuaW5nKG1vbnRoLCB5ZWFyKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbW9udGggIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIHllYXIgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9udGggJiYgeWVhcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUobmV3IERhdGUoeWVhciwgbW9udGgpLnNldERhdGUoMCkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAgIHZhciBuZXh0WWVhciA9IG5ldyBEYXRlKGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCkgKyAxLCBjdXJyZW50RGF0ZS5nZXRNb250aCgpLCBjdXJyZW50RGF0ZS5nZXREYXRlKCkgLSAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKGV4cGlyYXRpb25EYXRlIC0gbmV4dFllYXIpIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiLmNyZWRpdF9jYXJkX2V4cGlyYXRpb25fd2FybmluZ1wiKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCIuY3JlZGl0X2NhcmRfZXhwaXJhdGlvbl93YXJuaW5nXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oXCJjaGFuZ2VcIiwgXCIucHRfY2hlY2tvdXQgW25hbWUkPVxcXCJjcmVkaXRDYXJkX2V4cGlyYXRpb25fbW9udGhcXFwiXSwgLnB0X2NoZWNrb3V0IFtuYW1lJD1cXFwiY3JlZGl0Q2FyZF9leHBpcmF0aW9uX3llYXJcXFwiXVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtb250aCA9ICQoXCIucHRfY2hlY2tvdXQgW25hbWUkPVxcXCJjcmVkaXRDYXJkX2V4cGlyYXRpb25fbW9udGhcXFwiXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIHllYXIgPSAkKFwiLnB0X2NoZWNrb3V0IFtuYW1lJD1cXFwiY3JlZGl0Q2FyZF9leHBpcmF0aW9uX3llYXJcXFwiXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdG9nZ2xlRXhwaXJhdGlvbldhcm5pbmcobW9udGgsIHllYXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIFwiI2NoZWNrb3V0LW1haW4gW25hbWUkPVxcXCJjcmVkaXRDYXJkRmllbGRzX2V4cGlyYXRpb25Nb250aFxcXCJdLCAjY2hlY2tvdXQtbWFpbiBbbmFtZSQ9XFxcImNyZWRpdENhcmRGaWVsZHNfZXhwaXJhdGlvblllYXJcXFwiXVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtb250aCA9ICQoXCIjY2hlY2tvdXQtbWFpbiBbbmFtZSQ9XFxcImNyZWRpdENhcmRGaWVsZHNfZXhwaXJhdGlvbk1vbnRoXFxcIl1cIikudmFsKCk7XHJcbiAgICAgICAgICAgIHZhciB5ZWFyID0gJChcIiNjaGVja291dC1tYWluIFtuYW1lJD1cXFwiY3JlZGl0Q2FyZEZpZWxkc19leHBpcmF0aW9uWWVhclxcXCJcIikudmFsKCk7XHJcbiAgICAgICAgICAgIHRvZ2dsZUV4cGlyYXRpb25XYXJuaW5nKG1vbnRoLCB5ZWFyKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICogQGZ1bmN0aW9uXHJcbiAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6ZSByZWFjdGl2YXRlIG9yZGVyIHZpZXdcclxuICAgICAqL1xyXG4gICAgU21hcnRPcmRlclJlZmlsbC5pbml0UmVhY3RpdmF0ZU9yZGVyVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKGRvY3VtZW50KS5vZmYoXCJjbGlja1wiLCBcIi5vcmRlci5yZWFjdGl2YXRlXCIpLm9uKFwiY2xpY2tcIiwgXCIub3JkZXIucmVhY3RpdmF0ZVwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9yZGVyID0gZ2V0VVJMUGFyYW1ldGVyKHVybCwgXCJzaWRcIik7XHJcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9IFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRDb250YWluZXIoXCIjcmVhY3RpdmF0ZS1vcmRlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb250YWluZXIuaHRtbChcIjxoMz5cIiArIFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1JFQUNUSVZFX09SREVSX01FU1NBR0UgKyBcIjwvaDM+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBTbWFydE9yZGVyUmVmaWxsLk1vZGFsT3B0aW9ucy5yZWFjdGl2YXRlT3JkZXJWaWV3T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5tYW5hZ2VPcmRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqIEBmdW5jdGlvblxyXG4gICAgICogQGRlc2NyaXB0aW9uIGluaXRpYWxpemUgcmVhY3RpdmF0ZSBzdWJzY3JpcHRpb24gdmlld1xyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRSZWFjdGl2YXRlU3Vic2NyaXB0aW9uVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKGRvY3VtZW50KS5vZmYoXCJjbGlja1wiLCBcIi5yZWFjdGl2YXRlc3Vic2NyaXB0aW9uXCIpLm9uKFwiY2xpY2tcIiwgXCIucmVhY3RpdmF0ZXN1YnNjcmlwdGlvblwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSBTbWFydE9yZGVyUmVmaWxsLmNyZWF0Q29udGFpbmVyKFwiI3JlYWN0aXZhdGUtc3Vic2NyaXB0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBTbWFydE9yZGVyUmVmaWxsLk1vZGFsT3B0aW9ucy5yZWFjdGl2YXRlU3Vic2NyaXB0aW9uT3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICAkY29udGFpbmVyLmxvYWQodXJsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyogKioqKioqIEVuZCBvZiBBY2NvdW50IHNlY3Rpb24gKioqKioqICovXHJcblxyXG4gICAgLyogKioqKioqKiBTdGFydCBvZiBDYXJ0IHNlY3Rpb24gKioqKioqKiAqL1xyXG5cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdE1vZGlmeVJlZmlsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI21vZGlmeVJlZmlsbFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoIWUuZGV0YWlsIHx8IGUuZGV0YWlsID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyICRjb250YWluZXIgPSBTbWFydE9yZGVyUmVmaWxsLmNyZWF0Q29udGFpbmVyKFwiI21vZGlmeS1zbWFydC1vcmRlci1yZWZpbGxcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgJGNvbnRhaW5lci5sb2FkKHVybCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwubGltaXRDaGFyYWN0ZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBTbWFydE9yZGVyUmVmaWxsLk1vZGFsT3B0aW9ucy5tb2RpZnlSZWZpbGxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBmb3JjZSB0byBsb2FkIHRoZSBzZWxlY3RlZCB2YWx1ZSBvZiBzb3Igc3Vic2NyaXB0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCJbbmFtZT1cXFwiZXZlcnlEZWxpdmVyeVxcXCJdXCIpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNtb2RpZnktc21hcnQtb3JkZXItcmVmaWxsIHNlbGVjdFwiKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbXVsdGlwbGVSZWZpbGxcIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRSZW1vdmVSZWZpbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNyZW1vdmVSZWZpbGxcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlLmRldGFpbCB8fCBlLmRldGFpbCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICQodGhpcykuYXR0cihcImRhdGEtbGlua1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBjYXJ0U2hvdyA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLmNhcnRTaG93O1xyXG5cclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGNhcnRTaG93O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VTkVYUEVDVEVEX0VSUk9SLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRMb2dpbkZyb21DYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjbWVzc2FnZV93cmFwcGVyIGFcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9IFNtYXJ0T3JkZXJSZWZpbGwuY3JlYXRDb250YWluZXIoXCIjc29ybG9naW5cIik7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbW9kYWw6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCI1MHJlbVwiLFxyXG4gICAgICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJGNvbnRhaW5lci5sb2FkKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLmxvZ2luRnJvbUNhcnRQYWdlLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmxpbWl0Q2hhcmFjdGVycygpO1xyXG4gICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNzb3Jsb2dpbiBidXR0b25cIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlLmRldGFpbCB8fCBlLmRldGFpbCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvcm0gPSAkKHRoaXMpLnBhcmVudHMoXCJmb3JtOmZpcnN0XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFNtYXJ0T3JkZXJSZWZpbGwudmFsaWRhdGVGb3JtKGZvcm0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGZvcm0uYXR0cihcImFjdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uc2VyaWFsaXplQXJyYXkoKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW3BhcmFtLm5hbWVdID0gcGFyYW0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VTkVYUEVDVEVEX0VSUk9SLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChcIiNsb2dpbkZyb21DYXJ0RXJyb3JcIikubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbG9naW5Gcm9tQ2FydEVycm9yXCIpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCEkKFwiI2xvZ2luRnJvbUNhcnRFcnJvclwiKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnByZXBlbmQoXCI8ZGl2IGlkPVxcXCJsb2dpbkZyb21DYXJ0RXJyb3JcXFwiIGNsYXNzPVxcXCJlcnJvci1mb3JtXFxcIj5cIiArIFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX0xPR0lORlJPTUNBUlRfRVJST1IgKyBcIjwvZGl2PlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qICoqKioqKiogRW5kIG9mIENhcnQgc2VjdGlvbiAqKioqKioqICovXHJcblxyXG4gICAgLyogKioqKioqKiBTdGFydCBvZiBQcm9kdWN0IHNlY3Rpb24gKioqKioqKiAqL1xyXG5cclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdGlhbGl6ZVBkcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb24gU2hvdyBvciBoaWRlIHRoZSBzY2hlZHVsZSBzZWxlY3QgYmFzZWQgb24gdXNlciBzZWxlY3Rpb24uXHJcbiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSB2YWx1ZSBmb3JtIGVsZW1lbnQgdmFsdWVcclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBoaWRlT3JTaG93U2NoZWR1bGVzKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDU2OCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCIuc21hcnQtb3JkZXItcmVmaWxsLXBlcmlvZFwiKS5hdHRyKFwic3R5bGVcIiwgXCJtYXJnaW46IDAuOTM3NXJlbSAxLjI1cmVtXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJChcIi5zbWFydC1vcmRlci1yZWZpbGwtcGVyaW9kXCIpLmF0dHIoXCJzdHlsZVwiLCBcImRpc3BsYXk6aW5saW5lLWJsb2NrXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNhZGRQcm9kdWN0YnRuXCIpLmF0dHIoXCJzdHlsZVwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICQoXCIjZXZlcnlEZWxpdmVyeVwiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIi5vci1jYW5jZWwtZWRpdC10ZXh0XCIpLmF0dHIoXCJzdHlsZVwiLCBcIm1hcmdpbi10b3A6MC42MjVyZW1cIik7XHJcbiAgICAgICAgICAgICAgICAkKFwiLnNtYXJ0LW9yZGVyLXJlZmlsbC1wZXJpb2RcIikuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTpub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNhZGRQcm9kdWN0YnRuXCIpLmF0dHIoXCJzdHlsZVwiLCBcImRpc3BsYXk6bm9uZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb24gaW5pdGlhbGl6YSBvcHRpb25zXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdE9wdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIGlmICghJChcIi5zbWFydC1vcmRlci1yZWZpbGwtb3B0aW9uc1wiKS5kYXRhKFwic29yT25lVGltZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgJChcIi5zbWFydC1vcmRlci1yZWZpbGwtb3B0aW9ucyBbZm9yPVxcXCJPc2ZTb3JSZWZpbGxQcm9kdWN0Tm9cXFwiXSwgLnNtYXJ0LW9yZGVyLXJlZmlsbC1vcHRpb25zIFtmb3I9XFxcIk9zZlNvclJlZmlsbFByb2R1Y3RZZXNcXFwiXVwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAkKFwiI09zZlNvclJlZmlsbFByb2R1Y3RZZXNcIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCQoXCIuc21hcnQtb3JkZXItcmVmaWxsLXBlcmlvZCBwXCIpLmRhdGEoXCJkaXNhYmxlRHJvcGRvd25cIikpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjU29yRGVsaXZlcnlXZWVrSW50ZXJ2YWwsICNTb3JEZWxpdmVyeU1vbnRoSW50ZXJ2YWxcIikuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBcIm5vbmVcIlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGluaXRPcHRpb25zKCk7XHJcblxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIjcGRwTWFpbiAucHJvZHVjdC1hZGQtdG8tY2FydCBzZWxlY3QjU29yRGVsaXZlcnlNb250aEludGVydmFsXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJChcImlucHV0W25hbWU9XFxcImhhc1NtYXJ0T3JkZXJSZWZpbGxcXFwiXVwiKS52YWwoW1widHJ1ZVwiXSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoXCJpbnB1dFtuYW1lPWhhc1NtYXJ0T3JkZXJSZWZpbGxdXCIpLmNoYW5nZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGhpZGVPclNob3dTY2hlZHVsZXMoJCh0aGlzKS52YWwoKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIFwiW25hbWU9XFxcImV2ZXJ5RGVsaXZlcnlcXFwiXVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLnZhbCgpID09PSBcIm1vbnRoXCIpIHtcclxuICAgICAgICAgICAgICAgICQoXCJzZWxlY3RbbmFtZT1Tb3JEZWxpdmVyeVdlZWtJbnRlcnZhbF1cIikuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgJChcInNlbGVjdFtuYW1lPVNvckRlbGl2ZXJ5TW9udGhJbnRlcnZhbF1cIikuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoXCIuc21hcnQtb3JkZXItcmVmaWxsLXBlcmlvZCBwXCIpLmRhdGEoXCJkaXNhYmxlRHJvcGRvd25cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiI1NvckRlbGl2ZXJ5V2Vla0ludGVydmFsLCAjU29yRGVsaXZlcnlNb250aEludGVydmFsXCIpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS52YWwoKSA9PT0gXCJ3ZWVrXCIpIHtcclxuICAgICAgICAgICAgICAgICQoXCJzZWxlY3RbbmFtZT1Tb3JEZWxpdmVyeU1vbnRoSW50ZXJ2YWxdXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICQoXCJzZWxlY3RbbmFtZT1Tb3JEZWxpdmVyeVdlZWtJbnRlcnZhbF1cIikuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoXCIuc21hcnQtb3JkZXItcmVmaWxsLXBlcmlvZCBwXCIpLmRhdGEoXCJkaXNhYmxlRHJvcGRvd25cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiI1NvckRlbGl2ZXJ5V2Vla0ludGVydmFsLCAjU29yRGVsaXZlcnlNb250aEludGVydmFsXCIpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IFwibm9uZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChcIltuYW1lPVxcXCJldmVyeURlbGl2ZXJ5XFxcIl0sIHNlbGVjdFtuYW1lPVxcXCJTb3JEZWxpdmVyeVdlZWtJbnRlcnZhbFxcXCJdLCBzZWxlY3RbbmFtZT1cXFwiU29yRGVsaXZlcnlNb250aEludGVydmFsXFxcIl1cIikub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZXZlcnlEZWxpdmVyeUhhc1ZhbHVlU2VsZWN0ZWQgPSAkKFwiW25hbWU9XFxcImV2ZXJ5RGVsaXZlcnlcXFwiXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIHdlZWtJbnRlcnZhbEhhc1ZhbHVlU2VsZWN0ZWQgPSAkKFwic2VsZWN0W25hbWU9U29yRGVsaXZlcnlXZWVrSW50ZXJ2YWxdXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICB2YXIgbW9udGhJbnRlcnZhbEhhc1ZhbHVlU2VsZWN0ZWQgPSAkKFwic2VsZWN0W25hbWU9U29yRGVsaXZlcnlNb250aEludGVydmFsXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIHNvckRhdGFJbmZvcm1lZCA9IGV2ZXJ5RGVsaXZlcnlIYXNWYWx1ZVNlbGVjdGVkIHx8ICh3ZWVrSW50ZXJ2YWxIYXNWYWx1ZVNlbGVjdGVkIHx8IG1vbnRoSW50ZXJ2YWxIYXNWYWx1ZVNlbGVjdGVkKTtcclxuICAgICAgICAgICAgdmFyIHZhcmlhbnRTZWxlY3RlZCA9ICQoXCIucHJvZHVjdC1udW1iZXIgc3BhblwiKS50ZXh0KCk7XHJcbiAgICAgICAgICAgIHZhciBzaG91bGRFbmFibGVBZGRUb0NhcnRCdXR0b24gPSBzb3JEYXRhSW5mb3JtZWQgJiYgKHZhcmlhbnRTZWxlY3RlZCAhPT0gXCJ1bmRlZmluZWRcIik7XHJcbiAgICAgICAgICAgIHZhciBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoJChcIi5hZGQtdG8tY2FydFwiKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgIGlmICgkKFwiLmFkZC10by1jYXJ0XCIpWzBdLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJChcIiNhZGQtdG8tY2FydFwiKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgIGlmICgkKFwiI2FkZC10by1jYXJ0XCIpWzBdLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNob3VsZEVuYWJsZUFkZFRvQ2FydEJ1dHRvbiAmJiAhZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjYWRkLXRvLWNhcnRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChcIiNPc2ZTb3JSZWZpbGxQcm9kdWN0WWVzXCIpLnByb3AoXCJjaGVja2VkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1YW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKFwiLnF1YW50aXR5IGlucHV0XCIpLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTnVtYmVyKCQoXCIucXVhbnRpdHkgaW5wdXRcIikudmFsKCkpID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHkgPSBOdW1iZXIoJChcIi5xdWFudGl0eSBpbnB1dFwiKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI2FkZC10by1jYXJ0XCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHEgPSAwOyBxIDwgJChcIi5xdWFudGl0eS1zZWxlY3Qgb3B0aW9uXCIpLmxlbmd0aDsgcSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXV0ID0gJChcIi5xdWFudGl0eS1zZWxlY3Qgb3B0aW9uXCIpW3FdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1dC5zZWxlY3RlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gJChcIi5xdWFudGl0eS1zZWxlY3Qgb3B0aW9uXCIpW3FdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLmNoZWNrUHJvZHVjdFJlZmlsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzU21hcnRPcmRlclJlZmlsbDogJChcIltuYW1lPVxcXCJoYXNTbWFydE9yZGVyUmVmaWxsXFxcIl1cIikuZmlsdGVyKFwiOmNoZWNrZWRcIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVyeURlbGl2ZXJ5OiAkKFwiW25hbWU9XFxcImV2ZXJ5RGVsaXZlcnlcXFwiXVwiKS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNvckRlbGl2ZXJ5V2Vla0ludGVydmFsOiAkKFwiW25hbWU9XFxcIlNvckRlbGl2ZXJ5V2Vla0ludGVydmFsXFxcIl1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3JEZWxpdmVyeU1vbnRoSW50ZXJ2YWw6ICQoXCJbbmFtZT1cXFwiU29yRGVsaXZlcnlNb250aEludGVydmFsXFxcIl1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50U2VsZWN0ZWQ6ICQoXCJpbnB1dFtuYW1lPXZhcmlhbnRTZWxlY3RlZF1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWQ6IHZhcmlhbnRTZWxlY3RlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiBxdWFudGl0eVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjYWRkUHJvZHVjdGJ0blwiKS5yZW1vdmVDbGFzcyhcImhpZGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLmRhdGEoXCJzdWJJRHNcIiwgZGF0YS5zdWJzY3JpcHRpb25JRHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuYWRkRnJvbVBEUFwiKS5kYXRhKFwicGlkXCIsIHZhcmlhbnRTZWxlY3RlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5hZGRGcm9tUERQXCIpLmRhdGEoXCJpbnRlcnZhbFwiLCBkYXRhLmludGVydmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiLmFkZEZyb21QRFBcIikuZGF0YShcInBlcmlvZGljaXR5XCIsIGRhdGEucGVyaW9kaWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuYWRkRnJvbVBEUFwiKS5kYXRhKFwicXVhbnRpdHlcIiwgcXVhbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI2FkZFByb2R1Y3RidG5cIikuYWRkQ2xhc3MoXCJoaWRlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIub3ItY2FuY2VsLWVkaXQtdGV4dFwiKS5jc3MoXCJtYXJnaW5cIiwgXCIwIDAgMXJlbSAwcmVtXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2FkZFByb2R1Y3RidG5cIikucmVtb3ZlQ2xhc3MoXCJoaWRlXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNhZGQtdG8tY2FydFwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgICQoXCIuYWRkRnJvbVBEUFwiKS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAkKFwiLmFkZEZyb21QRFBcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciBsaW5rID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgICAgICAgICB2YXIgc3ViSURzID0gJCh0aGlzKS5kYXRhKFwic3ViSURzXCIpO1xyXG4gICAgICAgICAgICB2YXIgcGlkID0gJCh0aGlzKS5kYXRhKFwicGlkXCIpO1xyXG4gICAgICAgICAgICB2YXIgaW50ZXJ2YWwgPSAkKHRoaXMpLmRhdGEoXCJpbnRlcnZhbFwiKTtcclxuICAgICAgICAgICAgdmFyIHBlcmlvZGljaXR5ID0gJCh0aGlzKS5kYXRhKFwicGVyaW9kaWNpdHlcIik7XHJcbiAgICAgICAgICAgIHZhciBxdWFudGl0eTtcclxuICAgICAgICAgICAgaWYgKCQoXCIucXVhbnRpdHkgaW5wdXRcIikubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eSA9IE51bWJlcigkKFwiLnF1YW50aXR5IGlucHV0XCIpLnZhbCgpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gJCh0aGlzKS5kYXRhKFwicXVhbnRpdHlcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHF1YW50aXR5ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3Jtc2ctcXVhbnRpdHlcIikgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVycm9ybXNnLXF1YW50aXR5XCIpLmlubmVySFRNTCA9IFwiPGg0PjxoND5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gU21hcnRPcmRlclJlZmlsbC5jcmVhdENvbnRhaW5lcihcIiNhZGRwcm9kdWN0UERQXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBTbWFydE9yZGVyUmVmaWxsLk1vZGFsT3B0aW9ucy5hZGRQcm9kdWN0UERQT3B0aW9ucztcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBsaW5rLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViSURzOiBzdWJJRHMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZDogcGlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcmlvZGljaXR5OiBwZXJpb2RpY2l0eSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IHF1YW50aXR5XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250YWluZXIuaHRtbChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jcmVhdGVNb2RhbCgkY29udGFpbmVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3Jtc2ctcXVhbnRpdHlcIikuaW5uZXJIVE1MID0gXCI8aDQ+UXVhbnRpdHkgbXVzdCBiZSBhIGludGVnZXIgZ3JhdGVyIHRoZW4gMDxoND5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKFwiYm9keVwiKS5vbihcInByb2R1Y3Q6YWZ0ZXJBZGRUb0NhcnRcIiwgZnVuY3Rpb24gKGUsIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy51cGRhdGVSZWZpbGxEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInVwZGF0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNTbWFydE9yZGVyUmVmaWxsOiAkKFwiW25hbWU9XFxcImhhc1NtYXJ0T3JkZXJSZWZpbGxcXFwiXVwiKS5maWx0ZXIoXCI6Y2hlY2tlZFwiKS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlcnlEZWxpdmVyeTogJChcIltuYW1lPVxcXCJldmVyeURlbGl2ZXJ5XFxcIl1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvckRlbGl2ZXJ5V2Vla0ludGVydmFsOiAkKFwiW25hbWU9XFxcIlNvckRlbGl2ZXJ5V2Vla0ludGVydmFsXFxcIl1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvckRlbGl2ZXJ5TW9udGhJbnRlcnZhbDogJChcIltuYW1lPVxcXCJTb3JEZWxpdmVyeU1vbnRoSW50ZXJ2YWxcXFwiXVwiKS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGl1dWlkOiByZXNwb25zZS5wbGlVVUlEXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAkKFwiYm9keVwiKS5vbihcInByb2R1Y3Q6YWZ0ZXJBdHRyaWJ1dGVTZWxlY3RcIiwgZnVuY3Rpb24gKGUsIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucHJvZHVjdCAmJiByZXNwb25zZS5kYXRhLnByb2R1Y3QuaWQpIHtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLnVwZGF0ZVBEUE9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWQ6IHJlc3BvbnNlLmRhdGEucHJvZHVjdC5pZFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHN1Y2Nlc3NSZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVmaWxsT3B0aW9ucyA9ICQoc3VjY2Vzc1Jlc3BvbnNlKS5maWx0ZXIoXCIuc21hcnQtb3JkZXItcmVmaWxsLW9wdGlvbnNcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzUmVmaWxsSWQgPSBcIiNcIiArIHJlZmlsbE9wdGlvbnMuZmluZChcIltuYW1lPVxcXCJoYXNTbWFydE9yZGVyUmVmaWxsXFxcIl1cIikuZmlsdGVyKFwiOmNoZWNrZWRcIikuYXR0cihcImlkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlcnlEZWxpdmVyeSA9IHJlZmlsbE9wdGlvbnMuZmluZChcIltuYW1lPVxcXCJldmVyeURlbGl2ZXJ5XFxcIl1cIikudmFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ZWVrSW50ZXJ2YWwgPSByZWZpbGxPcHRpb25zLmZpbmQoXCJbbmFtZT1cXFwiU29yRGVsaXZlcnlXZWVrSW50ZXJ2YWxcXFwiXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vbnRoSW50ZXJ2YWwgPSByZWZpbGxPcHRpb25zLmZpbmQoXCJbbmFtZT1cXFwiU29yRGVsaXZlcnlNb250aEludGVydmFsXFxcIl1cIikudmFsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc29yUHJpY2UgPSByZWZpbGxPcHRpb25zLmZpbmQoXCIuc29yLXByaWNlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc29yUHJpY2VNZXNzYWdlID0gcmVmaWxsT3B0aW9ucy5maW5kKFwiLnNvci1wcmljZS1tZXNzYWdlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJChcIltuYW1lPVxcXCJldmVyeURlbGl2ZXJ5XFxcIl1cIikudmFsKGV2ZXJ5RGVsaXZlcnkpLmNoYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiW25hbWU9XFxcIlNvckRlbGl2ZXJ5V2Vla0ludGVydmFsXFxcIl1cIikudmFsKHdlZWtJbnRlcnZhbCkuY2hhbmdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCJbbmFtZT1cXFwiU29yRGVsaXZlcnlNb250aEludGVydmFsXFxcIl1cIikudmFsKG1vbnRoSW50ZXJ2YWwpLmNoYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnNtYXJ0LW9yZGVyLXJlZmlsbC1vcHRpb25zIC5zb3ItcHJpY2VcIikucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuc21hcnQtb3JkZXItcmVmaWxsLW9wdGlvbnMgLnNvci1wcmljZS1tZXNzYWdlXCIpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc29yUHJpY2UubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnNtYXJ0LW9yZGVyLXJlZmlsbC1vcHRpb25zXCIpLmFwcGVuZChzb3JQcmljZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnNtYXJ0LW9yZGVyLXJlZmlsbC1vcHRpb25zXCIpLmFwcGVuZChzb3JQcmljZU1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaGFzUmVmaWxsSWQpLnByb3AoXCJjaGVja2VkXCIsIHRydWUpLmNoYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0T3B0aW9ucygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRlT3JTaG93U2NoZWR1bGVzKCQoXCJpbnB1dFtuYW1lPWhhc1NtYXJ0T3JkZXJSZWZpbGxdOmNoZWNrZWRcIikudmFsKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaGlkZU9yU2hvd1NjaGVkdWxlcygkKFwiaW5wdXRbbmFtZT1oYXNTbWFydE9yZGVyUmVmaWxsXTpjaGVja2VkXCIpLnZhbCgpKTtcclxuICAgIH07XHJcblxyXG4gICAgXHJcbiAgICAvLyBnZW5lcmljIG1ldGhvZCBmb3IgZnVuY3Rpb25zIHdpdGhvdXQgQWpheCBjYWxsc1xyXG4gICAgU21hcnRPcmRlclJlZmlsbC5pbml0TGlua01vZGVsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9mZihcImNsaWNrXCIsIFwiLnNvcnNob3dtb2RhbFwiKS5vbihcImNsaWNrXCIsIFwiLnNvcnNob3dtb2RhbFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWxpbmtcIik7XHJcbiAgICAgICAgICAgIHZhciB0aXRsZSA9ICQodGhpcykuYXR0cihcImRhdGEtdGl0bGVcIik7XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1jb250ZW50XCIpO1xyXG4gICAgICAgICAgICB2YXIgeWVzID0gJCh0aGlzKS5hdHRyKFwiZGF0YS15ZXNcIik7XHJcbiAgICAgICAgICAgIHZhciBubyA9ICQodGhpcykuYXR0cihcImRhdGEtbm9cIik7XHJcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gU21hcnRPcmRlclJlZmlsbC5jcmVhdENvbnRhaW5lcihcIiNsaW5rLW1vZGVsXCIpO1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGF1dG9PcGVuOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbW9kYWw6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogXCIyNXJlbVwiLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uczoge31cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICh5ZXMpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuYnV0dG9uc1t5ZXNdID0gU21hcnRPcmRlclJlZmlsbC5CdXR0b25GdW5jdGlvbnMubGlua01vZGVsWWVzLmJpbmQoJGNvbnRhaW5lciwgdXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobm8pIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuYnV0dG9uc1tub10gPSBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJGNvbnRhaW5lci5odG1sKFwiPGgzPlwiICsgY29udGVudCArIFwiPC9oMz5cIik7XHJcblxyXG4gICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNyZWF0ZU1vZGFsKCRjb250YWluZXIsIG9wdGlvbnMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBnZW5lcmljIG1ldGhvZCBmb3IgZXJyb3IgbWVzc2FnZXNcclxuICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwgPSBmdW5jdGlvbiAoY29udGVudCwgcmVmcmVzUGFnZSkge1xyXG4gICAgICAgIHZhciAkY29udGFpbmVyID0gU21hcnRPcmRlclJlZmlsbC5jcmVhdENvbnRhaW5lcihcIiNlcnJvci1tb2RlbFwiKTtcclxuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXV0b09wZW46IHRydWUsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfRVJST1JfVElUTEUsXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjI1cmVtXCIsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IHtcclxuICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfT0s6IFNtYXJ0T3JkZXJSZWZpbGwuQnV0dG9uRnVuY3Rpb25zLnJlbG9hZERhc2hib2FyZC5iaW5kKCRjb250YWluZXIsIHJlZnJlc1BhZ2UpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY29udGFpbmVyLmh0bWwoXCI8aDM+XCIgKyBjb250ZW50ICsgXCI8L2gzPlwiKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNyZWF0ZU1vZGFsKCRjb250YWluZXIsIG9wdGlvbnMpO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8gKioqKiogQlVUVE9OUyBGVU5DVElPTlMgKioqKioqXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLkJ1dHRvbkZ1bmN0aW9ucyA9IHtcclxuICAgICAgICAvLyByZWFjdGl2YXRlU3Vic2NyaXB0aW9uXHJcbiAgICAgICAgcmVhY3RpdmF0ZVN1YnNjcmlwdGlvblNhdmU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChcIiNyZWFjdGl2ZVN1YnNcIik7XHJcbiAgICAgICAgICAgIHZhciBmb3JtVmFsaWQgPSBTbWFydE9yZGVyUmVmaWxsLnZhbGlkYXRlRm9ybSgkZm9ybSk7XHJcbiAgICAgICAgICAgIGlmICgkZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1WYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoXCJhY3Rpb25cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAkZm9ybS5zZXJpYWxpemUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5tYW5hZ2VPcmRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVsb2FkRGFzaGJvYXJkOiBmdW5jdGlvbiAocmVmcmVzUGFnZSkge1xyXG4gICAgICAgICAgICBpZiAocmVmcmVzUGFnZSkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlVybHMubWFuYWdlT3JkZXJzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBpbml0UmVhY3RpdmF0ZU9yZGVyVmlld1xyXG4gICAgICAgIHJlYWN0aXZhdGVPcmRlclZpZXdPazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5jYW5jZWxPbmVPcmRlcixcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZDogb3JkZXIgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLm1hbmFnZU9yZGVycztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBsaW5rTW9kZWxZZXM6IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlVybHMubWFuYWdlT3JkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwocmVzcG9uc2UubWVzc2FnZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8gaW5pdFVwZGF0ZUNyZWRpdENhcmRGb3JtXHJcbiAgICAgICAgdXBkYXRlQ3JlZGl0Q2FyZEZvcm1TYXZlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoXCIjZWRpdENyZWRpdENhcmRcIik7XHJcbiAgICAgICAgICAgIHZhciBmb3JtVmFsaWQgPSBTbWFydE9yZGVyUmVmaWxsLnZhbGlkYXRlRm9ybSgkZm9ybSk7XHJcbiAgICAgICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIHRvZGF5LnNldEhvdXJzKDAsIDAsIDApO1xyXG4gICAgICAgICAgICB2YXIgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICB2YXIgeWVhciA9IHBhcnNlSW50KCRmb3JtLmZpbmQoXCJbbmFtZSQ9J3VwZGF0ZWNhcmRfZXhwaXJhdGlvbl95ZWFyJ11cIikudmFsKCksIDEwKTtcclxuICAgICAgICAgICAgdmFyIG1vbnRoID0gcGFyc2VJbnQoJGZvcm0uZmluZChcIltuYW1lJD0ndXBkYXRlY2FyZF9leHBpcmF0aW9uX21vbnRoJ11cIikudmFsKCksIDEwKTtcclxuICAgICAgICAgICAgaWYgKHllYXIgJiYgbW9udGgpIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlLnNldE1vbnRoKG1vbnRoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZS5zZXRGdWxsWWVhcih5ZWFyKTtcclxuICAgICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlLnNldEhvdXJzKDAsIDAsIDApO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cGlyYXRpb25EYXRlLmdldFRpbWUoKSA8PSB0b2RheS5nZXRUaW1lKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9DUkVESVRDQVJEX0VSUk9SKTsgLy8gTk9TT05BUlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGZvcm0uZmluZChcIi5jaG9vc2UtY2FyZC13cmFwcGVyXCIpLmxlbmd0aCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRjYXJkU2VsZWN0cyA9ICQoXCIjZWRpdENyZWRpdENhcmRcIikuZmluZChcIltuYW1lJD1cXFwidXBkYXRlY2FyZF9jb25maXJtXFxcIl1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRmb3JtLmZpbmQoXCJbbmFtZSQ9XFxcInVwZGF0ZWNhcmRfY29uZmlybVxcXCJdXCIpLmZpbHRlcihcIjpjaGVja2VkXCIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY2FyZFNlbGVjdHMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNhcmRTZWxlY3QgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkY2FyZFNlbGVjdC5wcm9wKFwiY2hlY2tlZFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJkU2VsZWN0LnBhcmVudHMoXCIuY2hvb3NlLWNhcmQtaXRlbVwiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoXCJhY3Rpb25cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAkZm9ybS5zZXJpYWxpemUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5tYW5hZ2VPcmRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX0NSRURJVENBUkRfRVJST1IpOyAvLyBOT1NPTkFSXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUik7IC8vIE5PU09OQVJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGFkZFByb2R1Y3RGb3JtUERQU2F2ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKFwiI2FkZFByb2R1Y3RQRFBGb3JtXCIpO1xyXG4gICAgICAgICAgICB2YXIgZm9ybVZhbGlkID0gU21hcnRPcmRlclJlZmlsbC52YWxpZGF0ZUZvcm0oJGZvcm0pO1xyXG4gICAgICAgICAgICB2YXIgc2lkID0gJChcImlucHV0W25hbWU9c29yLXN1YnNdOmNoZWNrZWRcIikudmFsKCk7XHJcbiAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9ICQoXCIuYWRkRnJvbVBEUFwiKS5kYXRhKFwiaW50ZXJ2YWxcIik7XHJcbiAgICAgICAgICAgIHZhciBwZXJpb2RpY2l0eSA9ICQoXCIuYWRkRnJvbVBEUFwiKS5kYXRhKFwicGVyaW9kaWNpdHlcIik7XHJcbiAgICAgICAgICAgIHZhciBwaWQgPSAkKFwiLmFkZEZyb21QRFBcIikuZGF0YShcInBpZFwiKTtcclxuICAgICAgICAgICAgdmFyIHF1YW50aXR5ID0gJChcIi5hZGRGcm9tUERQXCIpLmRhdGEoXCJxdWFudGl0eVwiKTtcclxuICAgICAgICAgICAgaWYgKGZvcm1WYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJGZvcm0uYXR0cihcImFjdGlvblwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyaW9kaWNpdHk6IHBlcmlvZGljaXR5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IGludGVydmFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkOiBwaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0eTogcXVhbnRpdHksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWQ6IHNpZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuY2xvc2VNb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLm1hbmFnZU9yZGVycztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGFkZFByb2R1Y3RGb3JtU2F2ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKFwiI2FkZFByb2R1Y3RGb3JtXCIpO1xyXG4gICAgICAgICAgICB2YXIgZm9ybVZhbGlkID0gU21hcnRPcmRlclJlZmlsbC52YWxpZGF0ZUZvcm0oJGZvcm0pO1xyXG4gICAgICAgICAgICB2YXIgdmFyaWF0aW9uID0gJGZvcm0uZmluZChcIltuYW1lJD0nYWRkcHJvZHVjdF92YXJpYXRpb24nXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIHBlcmlvZGljaXR5ID0gJGZvcm0uZmluZChcIltuYW1lJD0nYWRkcHJvZHVjdF9wZXJpb2RpY2l0eSddXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICB2YXIgaW50ZXJ2YWwgPSAkZm9ybS5maW5kKFwiW25hbWUkPSdhZGRwcm9kdWN0X2ludGVydmFsJ11cIikudmFsKCk7XHJcbiAgICAgICAgICAgIHZhciBxdWFudGl0eSA9ICRmb3JtLmZpbmQoXCJbbmFtZSQ9J2FkZHByb2R1Y3RfcXVhbnRpdHknXVwiKS52YWwoKTtcclxuICAgICAgICAgICAgaWYgKGZvcm1WYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJGZvcm0uYXR0cihcImFjdGlvblwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyaW9kaWNpdHk6IHBlcmlvZGljaXR5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IGludGVydmFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlkOiB2YXJpYXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0eTogcXVhbnRpdHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5tYW5hZ2VPcmRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBpbml0Q2hhbmdlUHJvZHVjdEZvcm1cclxuICAgICAgICBjaGFuZ2VQcm9kdWN0Rm9ybVNhdmU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChcIiNlZGl0UHJvZHVjdEZvcm1cIik7XHJcbiAgICAgICAgICAgIHZhciBwcm9kdWN0ID0gJChcIi5wcm9kdWN0LXNlbGVjdFwiKS52YWwoKTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoXCJhY3Rpb25cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQcm9kdWN0OiBwcm9kdWN0XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwuY2FsbCgkY29udGFpbmVyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuVXJscy5tYW5hZ2VPcmRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfUFJPRFVDVF9FUlJPUik7IC8vIE5PU09OQVJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBpbml0QWRkcmVzc0NoYW5nZUZvcm1cclxuICAgICAgICBhZGRyZXNzQ2hhbmdlRm9ybVNhdmU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChcIiNlZGl0QWRkcmVzc0Zvcm1cIik7XHJcbiAgICAgICAgICAgIHZhciBmb3JtVmFsaWQgPSBTbWFydE9yZGVyUmVmaWxsLnZhbGlkYXRlRm9ybSgkZm9ybSk7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBTbWFydE9yZGVyUmVmaWxsLmFkZHJlc3NDaGFuZ2VJbmZvLnRhcmdldDtcclxuICAgICAgICAgICAgdmFyIHVybHZpZXcgPSBTbWFydE9yZGVyUmVmaWxsLmFkZHJlc3NDaGFuZ2VJbmZvLnVybHZpZXc7XHJcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gU21hcnRPcmRlclJlZmlsbC5hZGRyZXNzQ2hhbmdlSW5mby5jb250YWluZXI7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICghZm9ybVZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoXCJhY3Rpb25cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGZvcm0uc2VyaWFsaXplKClcclxuICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYm9vdHN0cmFwTW9kYWxCb2R5ID0gJCh0YXJnZXQpLmZpbmQoXCIubW9kYWwgLm1vZGFsLWJvZHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9vdHN0cmFwTW9kYWxCb2R5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBib290c3RyYXBNb2RhbEJvZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRhcmdldCkubG9hZCh1cmx2aWV3LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5saW1pdENoYXJhY3RlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsLmNhbGwoJGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJChcImlucHV0W25hbWUkPVxcXCJfcG9zdGFsXFxcIl06aW52YWxpZFwiKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCJpbnB1dFtuYW1lJD1cXFwiX3Bvc3RhbFxcXCJdXCIpLnBhcmVudCgpLmFwcGVuZChcIjxsYWJlbCBjbGFzcz1cXFwiZXJyb3JcXFwiPlwiICsgU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5JTlZBTElEX1pJUCArIFwiPC9sYWJlbD5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9BRERSRVNTX0VSUk9SKTsgLy8gTk9TT05BUlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX1VORVhQRUNURURfRVJST1IpOyAvLyBOT1NPTkFSXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgbW9kaWZ5UmVmaWxsVXBkYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSAkKFwiI21vZGlmeS1zbWFydC1vcmRlci1yZWZpbGwgZm9ybVwiKS5hdHRyKFwiYWN0aW9uXCIpO1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIGhhc1NtYXJ0T3JkZXJSZWZpbGw6ICQoXCJbbmFtZT1cXFwiaGFzU21hcnRPcmRlclJlZmlsbFxcXCJdXCIpLmZpbHRlcihcIjpjaGVja2VkXCIpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgZXZlcnlEZWxpdmVyeTogJChcIltuYW1lPVxcXCJldmVyeURlbGl2ZXJ5XFxcIl1cIikudmFsKCksXHJcbiAgICAgICAgICAgICAgICBTb3JEZWxpdmVyeVdlZWtJbnRlcnZhbDogJChcIltuYW1lPVxcXCJTb3JEZWxpdmVyeVdlZWtJbnRlcnZhbFxcXCJdXCIpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgU29yRGVsaXZlcnlNb250aEludGVydmFsOiAkKFwiW25hbWU9XFxcIlNvckRlbGl2ZXJ5TW9udGhJbnRlcnZhbFxcXCJdXCIpLnZhbCgpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLmNhcnRTaG93O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8gKioqKioqICBPUFRJT05TICAqKioqKioqXHJcblxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5Nb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgLy8gaW5pdGFkZFByb2R1Y3RQRFBWaWV3XHJcbiAgICAgICAgYWRkUHJvZHVjdFBEUE9wdGlvbnM6IHtcclxuICAgICAgICAgICAgYXV0b09wZW46IHRydWUsXHJcbiAgICAgICAgICAgIGJnaWZyYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfQUREX1BST0RVQ1RfVElUTEUsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICBlbXB0eU9uQ2xvc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWR0aDogXCIyNXJlbVwiLFxyXG4gICAgICAgICAgICBidXR0b25zOiB7XHJcbiAgICAgICAgICAgICAgICBTT1JfR0xPQkFMX0NBTkNFTDogU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsLFxyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9TQVZFOiBTbWFydE9yZGVyUmVmaWxsLkJ1dHRvbkZ1bmN0aW9ucy5hZGRQcm9kdWN0Rm9ybVBEUFNhdmVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy8gaW5pdFJlYWN0aXZhdGVTdWJzY3JpcHRpb25WaWV3XHJcbiAgICAgICAgcmVhY3RpdmF0ZVN1YnNjcmlwdGlvbk9wdGlvbnM6IHtcclxuICAgICAgICAgICAgYXV0b09wZW46IHRydWUsXHJcbiAgICAgICAgICAgIGJnaWZyYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfUkVBQ1RJVkVfU1VCU0NSSVBUSU9OX1RJVExFLFxyXG4gICAgICAgICAgICBtb2RhbDogdHJ1ZSxcclxuICAgICAgICAgICAgZW1wdHlPbkNsb3NlOiBmYWxzZSxcclxuICAgICAgICAgICAgd2lkdGg6IFwiMjVyZW1cIixcclxuICAgICAgICAgICAgYnV0dG9uczoge1xyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9DQU5DRUw6IFNtYXJ0T3JkZXJSZWZpbGwuY2xvc2VNb2RhbCxcclxuICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfU0FWRTogU21hcnRPcmRlclJlZmlsbC5CdXR0b25GdW5jdGlvbnMucmVhY3RpdmF0ZVN1YnNjcmlwdGlvblNhdmVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIGluaXRSZWFjdGl2YXRlT3JkZXJWaWV3XHJcbiAgICAgICAgcmVhY3RpdmF0ZU9yZGVyVmlld09wdGlvbnM6IHtcclxuICAgICAgICAgICAgYXV0b09wZW46IHRydWUsXHJcbiAgICAgICAgICAgIGJnaWZyYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXRsZTogU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfUkVBQ1RJVkVfT1JERVJfVElUTEUsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICBlbXB0eU9uQ2xvc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWR0aDogXCIyNXJlbVwiLFxyXG4gICAgICAgICAgICBidXR0b25zOiB7XHJcbiAgICAgICAgICAgICAgICBTT1JfR0xPQkFMX09LOiBTbWFydE9yZGVyUmVmaWxsLkJ1dHRvbkZ1bmN0aW9ucy5yZWFjdGl2YXRlT3JkZXJWaWV3T2tcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIGluaXRVcGRhdGVDcmVkaXRDYXJkRm9ybVxyXG4gICAgICAgIHVwZGF0ZUNyZWRpdENhcmRGb3JtT3B0aW9uczoge1xyXG4gICAgICAgICAgICBhdXRvT3BlbjogdHJ1ZSxcclxuICAgICAgICAgICAgYmdpZnJhbWU6IHRydWUsXHJcbiAgICAgICAgICAgIHRpdGxlOiBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VUERBVEVfQ1JFRElUX0NBUkRfVElUTEUsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICBlbXB0eU9uQ2xvc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWR0aDogXCIzNy41cmVtXCIsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IHtcclxuICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfQ0FOQ0VMOiBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwsXHJcbiAgICAgICAgICAgICAgICBTT1JfR0xPQkFMX1NBVkU6IFNtYXJ0T3JkZXJSZWZpbGwuQnV0dG9uRnVuY3Rpb25zLnVwZGF0ZUNyZWRpdENhcmRGb3JtU2F2ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBpbml0QWRkUHJvZHVjdFxyXG4gICAgICAgIGFkZFByb2R1Y3RPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGF1dG9PcGVuOiB0cnVlLFxyXG4gICAgICAgICAgICBiZ2lmcmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX0FERF9QUk9EVUNUX1RJVExFLFxyXG4gICAgICAgICAgICBtb2RhbDogdHJ1ZSxcclxuICAgICAgICAgICAgZW1wdHlPbkNsb3NlOiBmYWxzZSxcclxuICAgICAgICAgICAgd2lkdGg6IFwiMjVyZW1cIixcclxuICAgICAgICAgICAgYnV0dG9uczoge1xyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9DQU5DRUw6IFNtYXJ0T3JkZXJSZWZpbGwuY2xvc2VNb2RhbCxcclxuICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfU0FWRTogU21hcnRPcmRlclJlZmlsbC5CdXR0b25GdW5jdGlvbnMuYWRkUHJvZHVjdEZvcm1TYXZlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIGluaXRDaGFuZ2VQcm9kdWN0Rm9ybVxyXG4gICAgICAgIGNoYW5nZVByb2R1Y3RGb3JtT3B0aW9uczoge1xyXG4gICAgICAgICAgICBhdXRvT3BlbjogdHJ1ZSxcclxuICAgICAgICAgICAgYmdpZnJhbWU6IHRydWUsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICBlbXB0eU9uQ2xvc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICB3aWR0aDogXCIyNXJlbVwiLFxyXG4gICAgICAgICAgICB0aXRsZTogXCJDaGFuZ2UgcHJvZHVjdFwiLFxyXG4gICAgICAgICAgICBidXR0b25zOiB7XHJcbiAgICAgICAgICAgICAgICBTT1JfR0xPQkFMX0NBTkNFTDogU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsLFxyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9TQVZFOiBTbWFydE9yZGVyUmVmaWxsLkJ1dHRvbkZ1bmN0aW9ucy5jaGFuZ2VQcm9kdWN0Rm9ybVNhdmVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLy8gaW5pdFN1YnNjcmlwdGlvblZpZXdcclxuICAgICAgICBzdWJzY3JpcHRpb25WaWV3T3B0aW9uczoge1xyXG4gICAgICAgICAgICBhdXRvT3BlbjogdHJ1ZSxcclxuICAgICAgICAgICAgbW9kYWw6IHRydWUsXHJcbiAgICAgICAgICAgIGRpYWxvZ0NsYXNzOiBcInNtYXJ0LW9yZGVyLXJlZmlsbC1tb2RhbFwiLFxyXG4gICAgICAgICAgICB3aWR0aDogXCI0My43NXJlbVwiLFxyXG4gICAgICAgICAgICB0aXRsZTogU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfRElBTE9HX1NVQlNDUklQVElPTixcclxuICAgICAgICAgICAgYnV0dG9uczoge1xyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9DTE9TRTogU21hcnRPcmRlclJlZmlsbC5jbG9zZU1vZGFsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIGluaXRPcmRlclZpZXdcclxuICAgICAgICBvcmRlclZpZXdPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGRpYWxvZ0NsYXNzOiBcInNtYXJ0LW9yZGVyLXJlZmlsbC1tb2RhbFwiLFxyXG4gICAgICAgICAgICBhdXRvT3BlbjogdHJ1ZSxcclxuICAgICAgICAgICAgbW9kYWw6IHRydWUsXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjQzLjc1cmVtXCIsXHJcbiAgICAgICAgICAgIHRpdGxlOiBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9ESUFMT0dfT1JERVIsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IHtcclxuICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfQ0xPU0U6IFNtYXJ0T3JkZXJSZWZpbGwuY2xvc2VNb2RhbFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb2RpZnlSZWZpbGxPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGRpYWxvZ0NsYXNzOiBcInNtYXJ0LW9yZGVyLXJlZmlsbC1tb2RhbFwiLFxyXG4gICAgICAgICAgICBtb2RhbDogdHJ1ZSxcclxuICAgICAgICAgICAgdGl0bGU6IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5SZXNvdXJjZXMuU09SX01PRElGWV9TTUFSVF9PUkRFUl9SRUZJTEwsXHJcbiAgICAgICAgICAgIHdpZHRoOiBcIjM3LjVyZW1cIixcclxuICAgICAgICAgICAgYnV0dG9uczoge1xyXG4gICAgICAgICAgICAgICAgU09SX0dMT0JBTF9VUERBVEU6IFNtYXJ0T3JkZXJSZWZpbGwuQnV0dG9uRnVuY3Rpb25zLm1vZGlmeVJlZmlsbFVwZGF0ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBpbml0QWRkcmVzc0NoYW5nZUZvcm1cclxuICAgICAgICBhZGRyZXNzQ2hhbmdlRm9ybU9wdGlvbnM6IGZ1bmN0aW9uICh0YXJnZXQsIHVybHZpZXcsICRjb250YWluZXIpIHtcclxuICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5hZGRyZXNzQ2hhbmdlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxyXG4gICAgICAgICAgICAgICAgdXJsdmlldzogdXJsdmlldyxcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJGNvbnRhaW5lclxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgYXV0b09wZW46IHRydWUsXHJcbiAgICAgICAgICAgICAgICBiZ2lmcmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1vZGFsOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZW1wdHlPbkNsb3NlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBcIjI1cmVtXCIsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJDaGFuZ2UgYWRkcmVzc1wiLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgIFNPUl9HTE9CQUxfQ0FOQ0VMOiBTbWFydE9yZGVyUmVmaWxsLmNsb3NlTW9kYWwsXHJcbiAgICAgICAgICAgICAgICAgICAgU09SX0dMT0JBTF9TQVZFOiBTbWFydE9yZGVyUmVmaWxsLkJ1dHRvbkZ1bmN0aW9ucy5hZGRyZXNzQ2hhbmdlRm9ybVNhdmVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbmtNb2RlbFllczogZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlVybHMubWFuYWdlT3JkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEVycm9yTW9kYWwoU21hcnRPcmRlclJlZmlsbFNldHRpbmdzLlJlc291cmNlcy5TT1JfVU5FWFBFQ1RFRF9FUlJPUiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuY2xvc2VNb2RhbCh0aGlzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5pbml0QWNjb3VudFNvclZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJChcIi5zaG93LWhpZGUtb3JkZXJzXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KFwiLnN1YnNjcmlwdGlvblNlY3Rpb25cIikuZmluZChcIi5zdWJzY3JpcHRpb25PcmRlcnNcIikuc2xpZGVUb2dnbGUoXCJzbG93XCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5pbml0U2tpcE5leHRTaGlwbWVudCA9IGZ1bmN0aW9uICgpe1xyXG4gICAgXHQkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiI3NraXBuZXh0c2hpcG1lbnRcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIFx0XHR2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgXHRcdCQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLm1hbmFnZU9yZGVycztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKHJlc3BvbnNlLm1lc3NhZ2UsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VTkVYUEVDVEVEX0VSUk9SLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcdH0pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgU21hcnRPcmRlclJlZmlsbC5jYW5jZWxTdWJzY3JpcHRpb24gPSBmdW5jdGlvbiAoKXtcclxuICAgIFx0JChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIiNjYW5jZWxzdWJzY3JpcHRpb25cIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIFx0XHR2YXIgdXJsID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1saW5rXCIpO1xyXG4gICAgXHRcdCQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5VcmxzLm1hbmFnZU9yZGVycztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRFcnJvck1vZGFsKHJlc3BvbnNlLm1lc3NhZ2UsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0RXJyb3JNb2RhbChTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuUmVzb3VyY2VzLlNPUl9VTkVYUEVDVEVEX0VSUk9SLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcdH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKiBAZnVuY3Rpb25cclxuICAgICAqIEBkZXNjcmlwdGlvbiBCaW5kcyBldmVudHMgdG8gdGhlIGNhcnQgcGFnZSAoZWRpdCBpdGVtJ3MgZGV0YWlscywgYm9udXMgaXRlbSdzIGFjdGlvbnMsIGNvdXBvbiBjb2RlIGVudHJ5KVxyXG4gICAgICovXHJcbiAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0U3Vic2NyaXB0aW9uVmlldygpO1xyXG4gICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdE9yZGVyVmlldygpO1xyXG4gICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdEFkZHJlc3NDaGFuZ2VGb3JtKCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0Q3JlZGl0Q2FyZEV4cGlyYXRpb25XYXJuaW5nKCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0Q2hhbmdlUHJvZHVjdEZvcm0oKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRSZWFjdGl2YXRlU3Vic2NyaXB0aW9uVmlldygpO1xyXG4gICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdFJlYWN0aXZhdGVPcmRlclZpZXcoKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRVcGRhdGVQcm9kdWN0UXVhbnRpdHkoKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRSZW1vdmVQcm9kdWN0KCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0VXBkYXRlUmVmaWxsKCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0TW9kaWZ5UmVmaWxsKCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0UmVtb3ZlUmVmaWxsKCk7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0TG9naW5Gcm9tQ2FydCgpO1xyXG4gICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdExpbmtNb2RlbCgpO1xyXG5cclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRpYWxpemVQZHAoKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmluaXRBY2NvdW50U29yVmlldygpO1xyXG4gICAgICAgIFNtYXJ0T3JkZXJSZWZpbGwuaW5pdFNraXBOZXh0U2hpcG1lbnQoKTtcclxuICAgICAgICBTbWFydE9yZGVyUmVmaWxsLmNhbmNlbFN1YnNjcmlwdGlvbigpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgU21hcnRPcmRlclJlZmlsbC5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiAkLmZuLmRpYWxvZyAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICBTbWFydE9yZGVyUmVmaWxsU2V0dGluZ3MuTW9kYWxUeXBlID0gXCJkaWFsb2dcIjtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAkLmZuLm1vZGFsICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgIFNtYXJ0T3JkZXJSZWZpbGxTZXR0aW5ncy5Nb2RhbFR5cGUgPSBcIm1vZGFsXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKFwiLnNvcmxpbmsudmlzdWFsbHktaGlkZGVuXCIpLnJlbW92ZUNsYXNzKFwidmlzdWFsbHktaGlkZGVuXCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vaW5pdGlhbGl6aW5nIGRhdGUgcGlja2VyXHJcbiAgICAgICAgJCgnLm1vZGlmeWRhdGVwaWNrZXInKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgXHR2YXIgZGVmRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykudmFsKCkpO1xyXG4gICAgICAgIFx0dmFyIG1heERhdGUgPSBuZXcgRGF0ZShkZWZEYXRlKTtcclxuICAgICAgICBcdCQodGhpcykuZGF0ZXBpY2tlcih7XHJcbiAgICAgICAgXHRcdGRhdGVGb3JtYXQ6ICdtbS9kZC95eScsXHJcbiAgICAgICAgXHRcdHNob3dPdGhlck1vbnRoczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1pbkRhdGU6IDIsXHJcbiAgICAgICAgICAgICAgICBtYXhEYXRlOiBuZXcgRGF0ZShtYXhEYXRlLnNldERhdGUobWF4RGF0ZS5nZXREYXRlKCkgKyAxMjApKSxcclxuICAgICAgICAgICAgICAgIGRheU5hbWVzTWluOiBbJ1N1bicsICdNb24nLCAnVHVlJywgJ1dlZCcsICdUaHUnLCAnRnJpJywgJ1NhdCddLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdERhdGU6IGRlZkRhdGUsXHJcbiAgICAgICAgICAgICAgICAvL2JlZm9yZVNob3dEYXk6IG5vV2Vla2VuZHNPckhvbGlkYXlzXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHdpbmRvdy5TbWFydE9yZGVyUmVmaWxsID0gU21hcnRPcmRlclJlZmlsbDtcclxuICAgIH0pO1xyXG59KHdpbmRvdy5qUXVlcnkpKTtcclxuIl19"}