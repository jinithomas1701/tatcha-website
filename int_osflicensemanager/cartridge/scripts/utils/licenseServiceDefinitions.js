"use strict";var Reader=require("dw/io/Reader"),XMLStreamReader=require("dw/io/XMLStreamReader"),Logger=require("dw/system/Logger"),Resource=require("dw/web/Resource"),OSFLicenseConstants=require("~/cartridge/scripts/utils/licenseConstants");function createRequest(e,r){return e.addParam("is_activate",r.is_activate),e.addParam("is_avkey",r.is_avkey),e.addParam("is_pcid",r.is_pcid),e.addParam("is_productid",r.is_productid),r}function parseResponse(e,r){var s={success:!1};try{for(var t=new Reader(r.text),a=new XMLStreamReader(t);a.hasNext();){if(a.next(),-1<a.getLocalName().indexOf("QuickLicenseManager")){var i=a.readXMLObject();s.statusCode=i.status.toString(),s.expiryDate=i.expiryDate.toString(),s.error=i.error.toString(),s.registeredComputerID=i.registeredComputerID.toString(),s.success=-1<OSFLicenseConstants.OSF_SERVICE.SUCCESS_CODE.indexOf(s.statusCode),s.statusCode!==OSFLicenseConstants.OSF_SERVICE.PERMANENT_CODE&&s.statusCode!==OSFLicenseConstants.OSF_SERVICE.REVOKED_CODE||(s.expiryDate=OSFLicenseConstants.EXPIRY_DATE.NONE);break}}a.close()}catch(e){Logger.error(Resource.msg("license.unknownerror","license",null)+": "+e.message)}return s}var retrieveLicenseInformation={createRequest:createRequest,parseResponse:parseResponse,filterLogMessage:function(e){return e}},defineInstallationUniqueID={createRequest:createRequest,parseResponse:parseResponse,filterLogMessage:function(e){return e}},verifyLicenseActivation={createRequest:function(e,r){return e.addParam("is_avkey",r.is_avkey),e.addParam("is_pcid",r.is_pcid),e.addParam("is_productid",r.is_productid),e.addParam("is_majorversion",r.is_majorversion),e.addParam("is_minorversion",r.is_minorversion),e.addParam("is_vendor",r.is_vendor),r},parseResponse:function(e,r){var s={success:!1};try{for(var t=new Reader(r.text),a=new XMLStreamReader(t);a.hasNext();){if(a.next(),-1<a.getLocalName().indexOf("QuickLicenseManager")){var i=a.readXMLObject();s.error=i.error.toString(),s.success=!s.error,s.error&&(s.registeredComputerID=i.registeredComputerID.toString(),s.errorCode=i.errorCode.toString());break}}a.close()}catch(e){Logger.error(Resource.msg("license.unknownerror","license",null)+": "+e.message)}return s},filterLogMessage:function(e){return e}};exports.retrieveLicenseInformation=retrieveLicenseInformation,exports.defineInstallationUniqueID=defineInstallationUniqueID,exports.verifyLicenseActivation=verifyLicenseActivation;